{
  "editable": true,
  "graphTooltip": 1,
  "id": 29,
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "title": "\ud83d\udcca Executive KPIs / \u5173\u952e\u6307\u6807",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 20
              },
              {
                "color": "orange",
                "value": 30
              },
              {
                "color": "red",
                "value": 40
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 5,
        "x": 0,
        "y": 1
      },
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT ROUND(AVG(CASE WHEN actual_consumption > 0 THEN absolute_pct_error END) * 100, 1) AS mape FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND ($__all = '$__all' OR shop_dept_id IN ($store))",
          "refId": "A"
        }
      ],
      "title": "Overall MAPE (7d) / \u6574\u4f53MAPE",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 20
              },
              {
                "color": "orange",
                "value": 30
              },
              {
                "color": "red",
                "value": 40
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 5,
        "x": 5,
        "y": 1
      },
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT ROUND(SUM(absolute_error) / NULLIF(SUM(actual_consumption), 0) * 100, 1) AS wmape FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND actual_consumption > 0 AND ($__all = '$__all' OR shop_dept_id IN ($store))",
          "refId": "A"
        }
      ],
      "title": "WMAPE (7d) / \u52a0\u6743MAPE",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 10
              },
              {
                "color": "orange",
                "value": 20
              },
              {
                "color": "red",
                "value": 30
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 5,
        "x": 10,
        "y": 1
      },
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT ROUND(AVG(CASE WHEN actual_consumption > 0 THEN bias_pct END) * 100, 1) AS bias FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND ($__all = '$__all' OR shop_dept_id IN ($store))",
          "refId": "A"
        }
      ],
      "title": "Bias / MFE (7d) / \u504f\u5dee",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "orange",
                "value": 40
              },
              {
                "color": "yellow",
                "value": 60
              },
              {
                "color": "green",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 5,
        "x": 15,
        "y": 1
      },
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT ROUND(SUM(CASE WHEN absolute_pct_error < 0.20 THEN 1 ELSE 0 END) / NULLIF(COUNT(*), 0) * 100, 1) AS accuracy_rate FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND actual_consumption > 0 AND ($__all = '$__all' OR shop_dept_id IN ($store))",
          "refId": "A"
        }
      ],
      "title": "Accuracy Rate (<20%) / \u547d\u4e2d\u7387",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 80
              },
              {
                "color": "green",
                "value": 90
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 4,
        "x": 20,
        "y": 1
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT ROUND(coverage_pct * 100, 1) AS coverage FROM test.forecast_accuracy_summary WHERE period_type = 'ROLLING_7D' AND dimension_type = 'OVERALL' ORDER BY period_end DESC LIMIT 1",
          "refId": "A"
        }
      ],
      "title": "Coverage / \u8986\u76d6\u7387",
      "type": "gauge"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 6
      },
      "title": "\ud83d\udcc8 Accuracy Trends / \u51c6\u786e\u5ea6\u8d8b\u52bf",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "fillOpacity": 5,
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 20
              },
              {
                "color": "red",
                "value": 40
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "MA7"
            },
            "properties": [
              {
                "id": "custom.lineWidth",
                "value": 3
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#1890ff",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 0
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "MA30"
            },
            "properties": [
              {
                "id": "custom.lineWidth",
                "value": 2
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    5
                  ],
                  "fill": "dash"
                }
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "purple",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 0
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 7
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "time_series",
          "rawSql": "SELECT accuracy_date AS time, ROUND(AVG(CASE WHEN actual_consumption > 0 THEN absolute_pct_error END) * 100, 1) AS 'Daily MAPE' FROM test.forecast_accuracy_daily WHERE $__timeFilter(accuracy_date) AND ($__all = '$__all' OR shop_dept_id IN ($store)) GROUP BY accuracy_date ORDER BY accuracy_date",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "time_series",
          "rawSql": "SELECT d.accuracy_date AS time, ROUND(AVG(sub.daily_mape), 1) AS 'MA7' FROM (SELECT accuracy_date, ROUND(AVG(CASE WHEN actual_consumption > 0 THEN absolute_pct_error END) * 100, 1) AS daily_mape FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB('$__from', INTERVAL 7 DAY) AND ($__all = '$__all' OR shop_dept_id IN ($store)) GROUP BY accuracy_date) sub INNER JOIN (SELECT DISTINCT accuracy_date FROM test.forecast_accuracy_daily WHERE $__timeFilter(accuracy_date)) d ON sub.accuracy_date BETWEEN DATE_SUB(d.accuracy_date, INTERVAL 6 DAY) AND d.accuracy_date GROUP BY d.accuracy_date ORDER BY d.accuracy_date",
          "refId": "B"
        }
      ],
      "title": "Daily MAPE Trend with Moving Averages / \u6bcf\u65e5MAPE\u8d8b\u52bf",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "#faad14",
            "mode": "fixed"
          },
          "custom": {
            "drawStyle": "line",
            "fillOpacity": 10,
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto"
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 7
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "time_series",
          "rawSql": "SELECT accuracy_date AS time, ROUND(AVG(CASE WHEN actual_consumption > 0 THEN bias_pct END) * 100, 1) AS 'Bias %' FROM test.forecast_accuracy_daily WHERE $__timeFilter(accuracy_date) AND ($__all = '$__all' OR shop_dept_id IN ($store)) GROUP BY accuracy_date ORDER BY accuracy_date",
          "refId": "A"
        }
      ],
      "title": "Daily Bias Trend / \u6bcf\u65e5\u504f\u5dee\u8d8b\u52bf",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "title": "\ud83c\udfea Store Performance / \u95e8\u5e97\u8868\u73b0",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 25
              },
              {
                "color": "red",
                "value": 40
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 17
      },
      "options": {
        "barWidth": 0.7,
        "legend": {
          "displayMode": "hidden"
        },
        "orientation": "horizontal",
        "showValue": "always",
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT CONCAT(shop_name, ' (', shop_dept_id, ')') AS store, ROUND(AVG(CASE WHEN actual_consumption > 0 THEN absolute_pct_error END) * 100, 1) AS MAPE FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND ($__all = '$__all' OR large_class_name IN ($category)) GROUP BY shop_dept_id, shop_name ORDER BY MAPE ASC",
          "refId": "A"
        }
      ],
      "title": "MAPE by Store (7d) / \u5404\u95e8\u5e97MAPE",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "center",
            "displayMode": "color-background-solid"
          },
          "decimals": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 25
              },
              {
                "color": "orange",
                "value": 35
              },
              {
                "color": "red",
                "value": 45
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Store"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "auto"
              },
              {
                "id": "custom.width",
                "value": 140
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 17
      },
      "options": {
        "showHeader": true,
        "sortBy": []
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT shop_name AS Store, ROUND(AVG(CASE WHEN DAYOFWEEK(accuracy_date)=2 THEN absolute_pct_error END)*100,0) AS Mon, ROUND(AVG(CASE WHEN DAYOFWEEK(accuracy_date)=3 THEN absolute_pct_error END)*100,0) AS Tue, ROUND(AVG(CASE WHEN DAYOFWEEK(accuracy_date)=4 THEN absolute_pct_error END)*100,0) AS Wed, ROUND(AVG(CASE WHEN DAYOFWEEK(accuracy_date)=5 THEN absolute_pct_error END)*100,0) AS Thu, ROUND(AVG(CASE WHEN DAYOFWEEK(accuracy_date)=6 THEN absolute_pct_error END)*100,0) AS Fri, ROUND(AVG(CASE WHEN DAYOFWEEK(accuracy_date)=7 THEN absolute_pct_error END)*100,0) AS Sat, ROUND(AVG(CASE WHEN DAYOFWEEK(accuracy_date)=1 THEN absolute_pct_error END)*100,0) AS Sun FROM test.forecast_accuracy_daily WHERE $__timeFilter(accuracy_date) AND actual_consumption > 0 GROUP BY shop_dept_id, shop_name ORDER BY shop_name",
          "refId": "A"
        }
      ],
      "title": "Store \u00d7 Day-of-Week Accuracy / \u95e8\u5e97\u00d7\u661f\u671f\u51c6\u786e\u5ea6",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 26
      },
      "title": "\ud83d\udce6 Product Category Performance / \u54c1\u7c7b\u8868\u73b0",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 25
              },
              {
                "color": "red",
                "value": 40
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 27
      },
      "options": {
        "barWidth": 0.7,
        "legend": {
          "displayMode": "hidden"
        },
        "orientation": "horizontal",
        "showValue": "always"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT COALESCE(large_class_name, 'Unknown') AS category, ROUND(AVG(CASE WHEN actual_consumption > 0 THEN absolute_pct_error END) * 100, 1) AS MAPE FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND ($__all = '$__all' OR shop_dept_id IN ($store)) GROUP BY large_class_name ORDER BY MAPE ASC",
          "refId": "A"
        }
      ],
      "title": "MAPE by Category (7d) / \u5404\u54c1\u7c7bMAPE",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "decimals": 0,
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 27
      },
      "options": {
        "barWidth": 0.6,
        "groupWidth": 0.7,
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "orientation": "vertical",
        "showValue": "auto"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT COALESCE(large_class_name, 'Unknown') AS category, ROUND(SUM(absolute_error), 0) AS 'Total Abs Error', ROUND(SUM(actual_consumption), 0) AS 'Total Volume' FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND actual_consumption > 0 AND ($__all = '$__all' OR shop_dept_id IN ($store)) GROUP BY large_class_name ORDER BY SUM(absolute_error) DESC",
          "refId": "A"
        }
      ],
      "title": "Volume vs Error by Category / \u54c1\u7c7b\u91cf\u7ea7\u4e0e\u8bef\u5dee",
      "type": "barchart"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 36
      },
      "title": "\ud83d\udea8 Alerts & Drift Detection / \u544a\u8b66\u4e0e\u6f02\u79fb\u68c0\u6d4b",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Severity"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 90
              },
              {
                "id": "custom.displayMode",
                "value": "color-text"
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "options": {
                      "BIAS": {
                        "color": "orange",
                        "text": "BIAS"
                      },
                      "COVERAGE": {
                        "color": "blue",
                        "text": "COVERAGE"
                      },
                      "CRITICAL": {
                        "color": "red",
                        "text": "CRITICAL"
                      },
                      "DRIFT": {
                        "color": "purple",
                        "text": "DRIFT"
                      },
                      "WARNING": {
                        "color": "yellow",
                        "text": "WARNING"
                      }
                    },
                    "type": "value"
                  }
                ]
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Description"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 400
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 37
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Time"
          }
        ]
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT alert_timestamp AS Time, alert_type AS Severity, entity_name AS Entity, metric_name AS Metric, ROUND(metric_value * 100, 1) AS 'Value %', LEFT(description, 200) AS Description FROM test.forecast_alerts WHERE is_acknowledged = FALSE ORDER BY alert_timestamp DESC LIMIT 20",
          "refId": "A"
        }
      ],
      "title": "Active Alerts / \u6d3b\u8dc3\u544a\u8b66",
      "type": "table"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "fillOpacity": 0,
            "lineWidth": 1,
            "pointSize": 3,
            "showPoints": "auto"
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 37
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "time_series",
          "rawSql": "SELECT s.period_end AS time, s.dimension_name AS metric, s.tracking_signal AS value FROM test.forecast_accuracy_summary s WHERE s.period_type = 'ROLLING_7D' AND s.dimension_type = 'STORE' AND $__timeFilter(s.period_end) ORDER BY s.period_end, s.dimension_name",
          "refId": "A"
        }
      ],
      "title": "Tracking Signal by Store / \u5404\u95e8\u5e97\u8ddf\u8e2a\u4fe1\u53f7",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 46
      },
      "title": "\ud83d\udcb0 Operational Impact / \u8fd0\u8425\u5f71\u54cd",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "description": "Estimated excess inventory from over-forecasting (forecast > actual). Positive forecast_error indicates over-prediction.\n\u8fc7\u5ea6\u9884\u6d4b\u5bfc\u81f4\u7684\u591a\u4f59\u5e93\u5b58\u4f30\u7b97\u3002\u6b63\u9884\u6d4b\u8bef\u5dee\u8868\u793a\u8fc7\u5ea6\u9884\u6d4b\u3002",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "#faad14",
            "mode": "fixed"
          },
          "decimals": 0,
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 47
      },
      "options": {
        "barWidth": 0.7,
        "legend": {
          "displayMode": "hidden"
        },
        "orientation": "horizontal",
        "showValue": "always"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT COALESCE(large_class_name, 'Unknown') AS category, ROUND(SUM(CASE WHEN forecast_error > 0 THEN forecast_error ELSE 0 END), 0) AS 'Over-Prediction (units)' FROM test.forecast_accuracy_daily WHERE $__timeFilter(accuracy_date) AND actual_consumption > 0 GROUP BY large_class_name ORDER BY SUM(CASE WHEN forecast_error > 0 THEN forecast_error ELSE 0 END) DESC",
          "refId": "A"
        }
      ],
      "title": "Over-Prediction Waste by Category / \u8fc7\u5ea6\u9884\u6d4b\u6d6a\u8d39(\u6309\u54c1\u7c7b)",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "description": "Potential stockout risk from under-forecasting (forecast < actual). Negative forecast_error indicates under-prediction.\n\u9884\u6d4b\u4e0d\u8db3\u5bfc\u81f4\u7684\u6f5c\u5728\u7f3a\u8d27\u98ce\u9669\u3002\u8d1f\u9884\u6d4b\u8bef\u5dee\u8868\u793a\u9884\u6d4b\u4e0d\u8db3\u3002",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "#ff4d4f",
            "mode": "fixed"
          },
          "decimals": 0,
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 47
      },
      "options": {
        "barWidth": 0.7,
        "legend": {
          "displayMode": "hidden"
        },
        "orientation": "horizontal",
        "showValue": "always"
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT CONCAT(shop_name, ' (', shop_dept_id, ')') AS store, ROUND(SUM(CASE WHEN forecast_error < 0 THEN ABS(forecast_error) ELSE 0 END), 0) AS 'Under-Prediction (units)' FROM test.forecast_accuracy_daily WHERE $__timeFilter(accuracy_date) AND actual_consumption > 0 GROUP BY shop_dept_id, shop_name ORDER BY SUM(CASE WHEN forecast_error < 0 THEN ABS(forecast_error) ELSE 0 END) DESC",
          "refId": "A"
        }
      ],
      "title": "Under-Prediction Exposure by Store / \u9884\u6d4b\u4e0d\u8db3(\u6309\u95e8\u5e97)",
      "type": "barchart"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 55
      },
      "title": "\ud83d\udd0d Drill-Down Detail / \u660e\u7ec6\u94bb\u53d6",
      "type": "row"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "MAPE %"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-background-solid"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 25
                    },
                    {
                      "color": "orange",
                      "value": 40
                    },
                    {
                      "color": "red",
                      "value": 60
                    }
                  ]
                }
              },
              {
                "id": "custom.width",
                "value": 90
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Bias Dir"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              },
              {
                "id": "custom.displayMode",
                "value": "color-text"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 56
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "MAPE %"
          }
        ]
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT goods_code AS 'Goods Code', MAX(goods_name) AS 'Product Name', MAX(large_class_name) AS Category, ROUND(AVG(CASE WHEN actual_consumption > 0 THEN absolute_pct_error END) * 100, 1) AS 'MAPE %', CASE WHEN AVG(forecast_error) > 0 THEN 'Over \u2191' ELSE 'Under \u2193' END AS 'Bias Dir', ROUND(AVG(absolute_error), 1) AS 'Avg Daily Err', COUNT(*) AS 'Days', COUNT(DISTINCT shop_dept_id) AS 'Stores' FROM test.forecast_accuracy_daily WHERE accuracy_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND actual_consumption > 0 AND ($__all = '$__all' OR shop_dept_id IN ($store)) AND ($__all = '$__all' OR large_class_name IN ($category)) GROUP BY goods_code HAVING COUNT(*) >= 3 ORDER BY AVG(CASE WHEN actual_consumption > 0 THEN absolute_pct_error END) DESC LIMIT 20",
          "refId": "A"
        }
      ],
      "title": "Top 20 Worst Predicted Products / \u9884\u6d4b\u6700\u5dee\u768420\u4e2a\u5546\u54c1",
      "type": "table"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "ef5ay9lchfg1sa"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "APE %"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-background-solid"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": null
                    },
                    {
                      "color": "yellow",
                      "value": 20
                    },
                    {
                      "color": "orange",
                      "value": 40
                    },
                    {
                      "color": "red",
                      "value": 60
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 66
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Date"
          }
        ]
      },
      "targets": [
        {
          "datasource": {
            "type": "mysql",
            "uid": "ef5ay9lchfg1sa"
          },
          "format": "table",
          "rawSql": "SELECT accuracy_date AS Date, shop_name AS Store, goods_code AS 'Goods Code', goods_name AS Product, ROUND(predicted_demand, 1) AS Predicted, ROUND(actual_consumption, 1) AS Actual, ROUND(forecast_error, 1) AS Error, ROUND(absolute_pct_error * 100, 1) AS 'APE %' FROM test.forecast_accuracy_daily WHERE $__timeFilter(accuracy_date) AND ($__all = '$__all' OR shop_dept_id IN ($store)) AND ($__all = '$__all' OR large_class_name IN ($category)) ORDER BY accuracy_date DESC, absolute_pct_error DESC LIMIT 100",
          "refId": "A"
        }
      ],
      "title": "Daily Accuracy Detail / \u6bcf\u65e5\u51c6\u786e\u5ea6\u660e\u7ec6",
      "type": "table"
    }
  ],
  "refresh": "1h",
  "tags": [
    "scm",
    "forecast",
    "accuracy",
    "ai-analytics",
    "uc-sc-01"
  ],
  "templating": {
    "list": [
      {
        "allValue": "",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "mysql",
          "uid": "ef5ay9lchfg1sa"
        },
        "includeAll": true,
        "multi": true,
        "name": "store",
        "query": "SELECT DISTINCT CONCAT(shop_dept_id, ' - ', shop_name) AS __text, CAST(shop_dept_id AS CHAR) AS __value FROM test.forecast_accuracy_daily ORDER BY shop_name",
        "refresh": 1,
        "sort": 1,
        "type": "query"
      },
      {
        "allValue": "",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "mysql",
          "uid": "ef5ay9lchfg1sa"
        },
        "includeAll": true,
        "multi": true,
        "name": "category",
        "query": "SELECT DISTINCT large_class_name AS __text, large_class_name AS __value FROM test.forecast_accuracy_daily WHERE large_class_name IS NOT NULL ORDER BY large_class_name",
        "refresh": 1,
        "sort": 1,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-14d",
    "to": "now"
  },
  "timezone": "browser",
  "title": "SCM - Demand Forecast Accuracy Monitor / \u9700\u6c42\u9884\u6d4b\u51c6\u786e\u5ea6\u76d1\u63a7",
  "uid": "uc-sc-01-forecast-accuracy",
  "version": 1
}
