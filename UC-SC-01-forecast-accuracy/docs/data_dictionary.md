# UC-SC-01 Forecast Accuracy Monitor
# Data Dictionary & Operational Guide / 数据字典与运维指南

> **Project:** UC-SC-01 Forecast Accuracy Monitor
> **Version:** 1.0
> **Last Updated:** 2026-02-15
> **Owner:** Supply Chain Analytics Team / 供应链分析团队
> **Status:** Production

---

## Table of Contents / 目录

1. [Overview / 概述](#1-overview--概述)
2. [Source Tables / 源数据表](#2-source-tables--源数据表)
   - 2.1 [Predictions / 预测数据](#21-predictions--预测数据)
   - 2.2 [Actuals (Stock Consumption) / 实际消耗数据](#22-actuals-stock-consumption--实际消耗数据)
   - 2.3 [Reason Code Mapping / 原因码映射](#23-reason-code-mapping--原因码映射)
   - 2.4 [Join Key Mapping / 关联键映射](#24-join-key-mapping--关联键映射)
   - 2.5 [Supporting Tables / 辅助表](#25-supporting-tables--辅助表)
3. [Target Tables (Analytics) / 目标分析表](#3-target-tables-analytics--目标分析表)
4. [Metric Definitions / 指标定义](#4-metric-definitions--指标定义)
5. [Data Flow Architecture / 数据流架构](#5-data-flow-architecture--数据流架构)
6. [Operational Guide / 运维指南](#6-operational-guide--运维指南)
   - 6.1 [Pipeline Execution / 管道执行](#61-pipeline-execution--管道执行)
   - 6.2 [Monitoring & Alerting / 监控与告警](#62-monitoring--alerting--监控与告警)
   - 6.3 [Troubleshooting / 故障排查](#63-troubleshooting--故障排查)
   - 6.4 [Data Quality Checks / 数据质量检查](#64-data-quality-checks--数据质量检查)
7. [Business Context / 业务背景](#7-business-context--业务背景)
8. [Appendix / 附录](#8-appendix--附录)

---

## 1. Overview / 概述

**EN:** The UC-SC-01 Forecast Accuracy Monitor evaluates the performance of the iReplenishment algorithm's demand predictions against actual store-level consumption. It computes standard forecast accuracy metrics (MAPE, WMAPE, RMSE, Bias, Tracking Signal) at the shop x goods x day granularity, enabling supply chain teams to identify systematic prediction drift, underperforming SKUs, and stores requiring model recalibration.

**CN:** UC-SC-01 预测准确度监控系统用于评估 iReplenishment 算法的需求预测与门店实际消耗之间的偏差。系统在 门店 x 商品 x 日 的粒度上计算标准预测准确度指标（MAPE、WMAPE、RMSE、偏差、追踪信号），帮助供应链团队识别系统性预测漂移、表现不佳的 SKU 以及需要模型重新校准的门店。

### Scope / 范围

| Dimension / 维度 | Coverage / 覆盖范围 |
|---|---|
| Stores / 门店 | 13 US stores + 1 Shanghai test kitchen / 13家美国门店 + 1家上海测试厨房 |
| Products / 商品 | ~88 unique GS codes / 约88个唯一GS编码 |
| Time Range / 时间范围 | Jan 2026 onward (~39K active rows) / 2026年1月起（约39K活跃行） |
| Granularity / 粒度 | Shop x Goods x Delivery Date / 门店 x 商品 x 配送日 |
| Refresh Cadence / 刷新频率 | Daily (T+1) / 每日（T+1） |

---

## 2. Source Tables / 源数据表

### 2.1 Predictions / 预测数据

**EN:** The predictions table contains demand forecasts generated by the iReplenishment algorithm. Each row represents a predicted demand quantity for a specific shop-goods-delivery_date combination.

**CN:** 预测数据表包含 iReplenishment 算法生成的需求预测。每行代表一个特定 门店-商品-配送日期 组合的预测需求量。

| Property / 属性 | Value / 值 |
|---|---|
| **Database Server** | `aws-luckyus-ireplenishment-rw` |
| **Schema.Table** | `luckyus_ireplenishment.t_order_predict_alg_v2` |
| **Total Rows / 总行数** | ~125,000 (all time); ~39,000 (since Jan 2026 / 2026年1月以来) |
| **Granularity / 粒度** | shop x goods x delivery_date / 门店 x 商品 x 配送日期 |
| **Primary Use / 主要用途** | Forecast values for accuracy comparison / 用于准确度对比的预测值 |

#### Column Definitions / 字段定义

| Column / 字段 | Type / 类型 | Description EN | 描述 CN | Nullable | Example / 示例 |
|---|---|---|---|---|---|
| `shop_dept_id` | INT | Store department ID; unique store identifier | 门店部门ID；唯一门店标识 | NO | `1127` |
| `shop_name` | VARCHAR | Store display name | 门店显示名称 | NO | `8th & Broadway` |
| `goods_code` | VARCHAR | GS code (raw material identifier) | GS编码（原材料标识） | NO | `GS00012345` |
| `goods_name` | VARCHAR | Product display name | 商品显示名称 | NO | `Espresso Beans 1kg` |
| `plan_finish_date` | DATE | Expected delivery date (the date stock arrives at store) | 预计配送日期（库存到达门店的日期） | NO | `2026-02-10` |
| `dt` | DATE | Prediction generation date (when the algorithm ran) | 预测生成日期（算法运行日期） | NO | `2026-02-08` |
| **`vlt_avg_demand`** | DECIMAL | **PRIMARY prediction value**: VLT (Vendor Lead Time) daily average demand. This is the core forecast metric used for accuracy evaluation. | **主要预测值**：VLT（供应商提前期）日均需求量。这是用于准确度评估的核心预测指标。 | NO | `15.5` |
| `bp_avg_demand` | DECIMAL | Base-period average demand (alternative forecast metric) | 基期平均需求量（备选预测指标） | YES | `12.3` |
| `order_num` | DECIMAL | Suggested order quantity (includes safety stock buffer) | 建议订货量（包含安全库存缓冲） | NO | `24.0` |
| `large_class_name` | VARCHAR | Product large category name | 商品大类名称 | YES | `Coffee Beans` |
| `task_version_id` | VARCHAR | Algorithm task version identifier (for model traceability) | 算法任务版本标识（用于模型追溯） | YES | `v2.3.1-20260208` |
| `dly_use_ratio` | DECIMAL | Delivery unit conversion ratio (delivery units to base units) | 配送单位转换比率（配送单位到基本单位） | YES | `1.0` |

> **IMPORTANT / 重要提示:**
> - `vlt_avg_demand` is the PRIMARY prediction value used for forecast accuracy calculation.
>   `vlt_avg_demand` 是用于预测准确度计算的主要预测值。
> - `order_num` includes safety stock and should NOT be used as the raw forecast value.
>   `order_num` 包含安全库存，不应作为原始预测值使用。
> - `dt` vs `plan_finish_date`: `dt` is when the prediction was made; `plan_finish_date` is the date being predicted for.
>   `dt` 是做出预测的日期；`plan_finish_date` 是被预测的目标日期。

#### Store Coverage / 门店覆盖范围

| shop_dept_id | Store Name / 门店名称 | Location / 位置 | Status / 状态 |
|---|---|---|---|
| 1127 | 8th & Broadway | Manhattan, NY | Active / 活跃 |
| 1128 | 28th & 6th | Manhattan, NY | Active / 活跃 |
| 1131 | NJ Test Kitchen | New Jersey | Active / 活跃 |
| 1140 | 100 Maiden Ln | Manhattan, NY | Active / 活跃 |
| 1141 | 54th & 8th | Manhattan, NY | Active / 活跃 |
| 20007 | NJ Test Kitchen 2 | New Jersey | Active / 活跃 |
| 20008 | 33rd & 10th | Manhattan, NY | Active / 活跃 |
| 20010 | 102 Fulton | Manhattan, NY | Active / 活跃 |
| 20011 | 37th & Broadway | Manhattan, NY | Active / 活跃 |
| 20027 | 21st & 3rd | Manhattan, NY | Active / 活跃 |
| 20031 | 15th & 3rd | Manhattan, NY | Active / 活跃 |
| 20032 | 221 Grand | Manhattan, NY | Active / 活跃 |
| 20046 | Shanghai Test Kitchen | Shanghai, CN | Test / 测试 |

> **Note / 备注:** Shanghai Test Kitchen (20046) is a test environment and should be excluded from production accuracy reporting unless explicitly included.
> 上海测试厨房 (20046) 为测试环境，除非明确要求，否则应从生产准确度报告中排除。

---

### 2.2 Actuals (Stock Consumption) / 实际消耗数据

**EN:** The actuals table records all stock movement events at the store level. Each row represents a single stock adjustment event (consumption, receiving, transfer, etc.). To derive actual consumption, specific reason codes must be filtered.

**CN:** 实际数据表记录门店级别的所有库存变动事件。每行代表一次库存调整事件（消耗、收货、调拨等）。要获取实际消耗量，必须按特定原因码进行筛选。

| Property / 属性 | Value / 值 |
|---|---|
| **Database Server** | `aws-luckyus-scm-shopstock-rw` |
| **Schema.Table (Primary)** | `luckyus_scm_shopstock.t_shop_goods_stock_change_record` |
| **Day-of-Week Tables** | `t_shop_goods_stock_change_record_mon` through `_sun` |
| **Primary Use / 主要用途** | Actual consumption values for accuracy comparison / 用于准确度对比的实际消耗值 |

#### Column Definitions / 字段定义

| Column / 字段 | Type / 类型 | Description EN | 描述 CN | Nullable | Example / 示例 |
|---|---|---|---|---|---|
| `shop_dept_id` | INT | Store department ID (matches prediction table) | 门店部门ID（与预测表匹配） | NO | `1127` |
| `goods_mid` | VARCHAR | GS code (raw material identifier; joins to predictions.goods_code) | GS编码（原材料标识；与predictions.goods_code关联） | NO | `GS00012345` |
| `total_adjust_num` | DECIMAL | Total physical adjustment quantity (actual measured change) | 实际物理调整量（实际测量变化） | NO | `-227.21` |
| `theory_total_adjust_num` | DECIMAL | Theoretical adjustment quantity (system-calculated expected change) | 理论调整量（系统计算的预期变化） | YES | `-35.19` |
| `reason_code` | VARCHAR | Adjustment reason code (determines event type) | 调整原因码（决定事件类型） | NO | `025` |
| `reason_type` | VARCHAR | Adjustment reason type (category grouping) | 调整原因类型（分类分组） | NO | `1` |
| `operated_time` | DATETIME | Timestamp when the stock adjustment occurred | 库存调整发生的时间戳 | NO | `2026-02-10 14:30:00` |

> **CRITICAL / 关键提示:**
> - The `total_adjust_num` and `theory_total_adjust_num` values are SIGNED: negative = consumption/outbound, positive = receiving/inbound.
>   `total_adjust_num` 和 `theory_total_adjust_num` 的值是带符号的：负数 = 消耗/出库，正数 = 收货/入库。
> - For forecast comparison, use ABSOLUTE values: `ABS(total_adjust_num)` or `ABS(theory_total_adjust_num)`.
>   用于预测对比时，使用绝对值：`ABS(total_adjust_num)` 或 `ABS(theory_total_adjust_num)`。
> - Day-of-week partitioned tables (`_mon` through `_sun`) contain the same schema but are partitioned by the day of week of `operated_time`. Use these for performance-optimized queries on specific days.
>   按星期分区的表（`_mon` 到 `_sun`）具有相同的表结构，但按 `operated_time` 的星期几进行分区。在查询特定日期时可用于性能优化。

---

### 2.3 Reason Code Mapping / 原因码映射

**EN:** This is the most critical reference for deriving actual consumption from stock change records. Incorrect reason code filtering will produce meaningless accuracy metrics. The table below classifies each reason code by its role in forecast accuracy calculation.

**CN:** 这是从库存变动记录中提取实际消耗量的最关键参考。错误的原因码筛选将产生无意义的准确度指标。下表按每个原因码在预测准确度计算中的作用进行分类。

#### Classification Legend / 分类图例

| Classification / 分类 | Meaning EN | 含义 CN | Color Code |
|---|---|---|---|
| **PRIMARY** | Core consumption signal; highest priority for forecast comparison | 核心消耗信号；预测对比的最高优先级 | GREEN |
| **SECONDARY** | Valid consumption signal; use when PRIMARY is unavailable | 有效消耗信号；当PRIMARY不可用时使用 | YELLOW |
| **EXCLUDE** | Not consumption; must be filtered out of accuracy calculations | 非消耗类型；必须从准确度计算中排除 | RED |

#### Reason Code Detail / 原因码详情

| reason_code | reason_type | Classification | Description EN | 描述 CN | Which Column to Use / 使用哪个字段 | Avg Adjustment / 平均调整量 | Rationale EN | 理由 CN |
|---|---|---|---|---|---|---|---|
| `1002` | `2001` | **PRIMARY** | Inventory adjustment (consumption) | 盘点/库存调整(消耗) | `total_adjust_num` (where < 0) | avg: -2,757.46 | Captures ~97% of actual physical consumption volume; negative values represent consumption outbound | 捕获约97%的实际物理消耗量；负值代表消耗出库 |
| `025` | `1002` | **PRIMARY** | Physical consumption deduction | 实物消耗扣减 | `total_adjust_num` (where < 0) | avg: -227.21 | Manual/physical consumption recording; valid demand signal | 手动/实际消耗记录；有效需求信号 |
| `1001` | `20001` | **PRIMARY** | Production consumption | 生产消耗 | `total_adjust_num` (where < 0) | avg: -136.35 | Production-line consumption; valid demand signal for raw materials used in preparation | 生产线消耗；用于制备的原材料的有效需求信号 |
| `019` | `1` | **EXCLUDE** | Theoretical auto-deduction | 理论自动扣减 | N/A | theory avg: -35.19 | Uses `theory_total_adjust_num` which gives values 10-40x lower than actual physical consumption; not suitable for accuracy comparison | 使用 `theory_total_adjust_num`，其值比实际物理消耗低10-40倍；不适合准确度对比 |
| `1000` | `2002` | **EXCLUDE** | Receiving / Delivery | 收货/配送 | N/A | avg: +8,527.87 | Inbound stock movement; not consumption. Large positive values indicate delivery receipts | 入库库存变动；非消耗。较大正值表示配送收货 |
| `013` | `1` | **EXCLUDE** | Theoretical consumption | 理论消耗 | N/A | theory avg: -43.83 | Theoretical values only; overlaps with 019; do not use for accuracy comparison | 仅理论值；与019重叠；不要用于准确度对比 |
| `010` | `1` | **EXCLUDE** | Theoretical consumption | 理论消耗 | N/A | theory avg: -86.77 | Redundant theoretical calculation; excluded to prevent double-counting | 重复的理论计算；排除以防止重复计算 |
| `1006` | `2006` | **EXCLUDE** | Transfer out | 调拨出 | N/A | avg: -507.12 | Inter-store transfer; movement between locations, not end consumption | 门店间调拨；位置间的移动，非终端消耗 |
| `1009` | `2006` | **EXCLUDE** | Transfer in | 调拨入 | N/A | avg: +474.32 | Inter-store transfer receipt; inbound from another store, not consumption | 门店间调拨接收；从其他门店入库，非消耗 |

#### Consumption Extraction Logic / 消耗量提取逻辑

```
ACTUAL CONSUMPTION (per shop x goods x day) =

  SUM(ABS(total_adjust_num))
  WHERE reason_code IN ('025', '1001', '1002')
    AND total_adjust_num < 0              -- only outbound/consumption records
  GROUP BY shop_dept_id, goods_mid, DATE(operated_time)

  EXCLUDE all other reason codes from the calculation.
```

> **CRITICAL / 关键提示:**
> - reason_code `1002` (inventory adjustments with negative total_adjust_num) captures ~97% of actual physical consumption.
>   原因码 `1002`（负值的库存调整）捕获约97%的实际物理消耗。
> - ALWAYS filter `total_adjust_num < 0` to isolate consumption (outbound) movements.
>   务必筛选 `total_adjust_num < 0` 以隔离消耗（出库）变动。
> - Never include reason_code `1000` (receiving) -- it will massively inflate "actual" values.
>   切勿包含原因码 `1000`（收货）-- 它会大幅膨胀"实际"值。
> - Do NOT use reason_code `019` -- it uses `theory_total_adjust_num` which gives values 10-40x lower than actual physical consumption.
>   不要使用原因码 `019` -- 它使用 `theory_total_adjust_num`，其值比实际物理消耗低10-40倍。

---

### 2.4 Join Key Mapping / 关联键映射

**EN:** The following join conditions link prediction records to actual consumption records for accuracy calculation.

**CN:** 以下关联条件将预测记录与实际消耗记录连接起来，用于准确度计算。

```
Predictions.shop_dept_id   =  Actuals.shop_dept_id           -- Store match / 门店匹配
Predictions.goods_code     =  Actuals.goods_mid              -- Product match (both GS codes) / 商品匹配（均为GS编码）
Predictions.plan_finish_date = DATE(Actuals.operated_time)   -- Date match / 日期匹配
```

#### Join Validation / 关联验证

| Join Key | Predictions Column | Actuals Column | Code System | Match Rate |
|---|---|---|---|---|
| Store | `shop_dept_id` (INT) | `shop_dept_id` (INT) | Internal store ID | 100% direct match |
| Product | `goods_code` (VARCHAR) | `goods_mid` (VARCHAR) | GS code (raw material) | 100% direct match |
| Date | `plan_finish_date` (DATE) | `DATE(operated_time)` (DATE) | Calendar date | Requires DATE() cast on actuals |

> **Note / 备注:**
> - The product code system is GS (raw material / 原材料编码), NOT PR (finished product / 成品编码) or SPU code.
> - When joining, ensure the actuals are aggregated to the daily level first: `GROUP BY shop_dept_id, goods_mid, DATE(operated_time)`.
>   关联时，确保先将实际数据聚合到日粒度：`GROUP BY shop_dept_id, goods_mid, DATE(operated_time)`。

---

### 2.5 Supporting Tables / 辅助表

These tables provide reference data for enrichment, BOM explosion, and sales-based validation.

这些表提供用于数据丰富化、BOM展开和基于销售验证的参考数据。

#### 2.5.1 Product Master / 商品主数据

| Property / 属性 | Value / 值 |
|---|---|
| **Database Server** | `aws-luckyus-pubdm-rw` |
| **Schema.Table** | `luckyus_pub_dm.t_mdm_goods` |
| **Row Count / 行数** | ~1,448 goods |
| **Primary Key / 主键** | `mid` (GS code) |

| Column / 字段 | Description EN | 描述 CN |
|---|---|---|
| `mid` | GS code (joins to goods_code / goods_mid) | GS编码（关联goods_code / goods_mid） |
| `name` | Product name | 商品名称 |
| `large_mid` | Large category ID | 大类ID |
| `small_mid` | Small category ID | 小类ID |

#### 2.5.2 Store Master / 门店主数据

| Property / 属性 | Value / 值 |
|---|---|
| **Database Server** | `aws-luckyus-opshop-rw` |
| **Schema.Table** | `luckyus_opshop.t_shop_info` |
| **Row Count / 行数** | ~517 stores (13 relevant to this project) |
| **Primary Key / 主键** | `id` = `shop_dept_id` |

#### 2.5.3 BOM (Bill of Materials) / 物料清单

| Property / 属性 | Value / 值 |
|---|---|
| **Database Server** | `aws-luckyus-scmcommodity-rw` |
| **Schema.Table** | `luckyus_scm_commodity.t_formula_spu` |
| **Row Count / 行数** | ~32,000 rows |
| **Purpose / 用途** | Maps finished products (PR/SPU) to raw materials (GS) with usage quantities |
| **用途说明** | 将成品（PR/SPU）映射到原材料（GS）及用量 |

| Column / 字段 | Description EN | 描述 CN |
|---|---|---|
| `spu_code` | SPU / PR code (finished product) | SPU/PR编码（成品） |
| `material_mid` | GS code (raw material) | GS编码（原材料） |
| `need_number` | Quantity of raw material needed per unit of finished product | 每单位成品所需原材料数量 |

> **Usage / 用途:** BOM is needed for the sales-based validation pathway: Sales (PR) -> BOM explosion -> Raw material demand (GS) -> Compare with predictions.
> BOM 用于基于销售的验证路径：销售（PR）-> BOM展开 -> 原材料需求（GS）-> 与预测对比。

#### 2.5.4 Sales Orders / 销售订单

| Property / 属性 | Value / 值 |
|---|---|
| **Database Server** | `aws-luckyus-salesorder-rw` |
| **Schema.Table (Orders)** | `luckyus_sales_order.t_order` |
| **Schema.Table (Items)** | `luckyus_sales_order.t_order_item` |
| **Row Count / 行数** | ~490K+ completed orders (status=90); ~607K order items |

| Column / 字段 | Table | Description EN | 描述 CN |
|---|---|---|---|
| `status` | t_order | Order status; `90` = completed | 订单状态；`90` = 已完成 |
| `spu_code` | t_order_item | SPU / PR code (finished product sold) | SPU/PR编码（已售成品） |

> **Note / 备注:** Sales data uses PR/SPU codes. To compare with GS-code predictions, BOM explosion is required.
> 销售数据使用PR/SPU编码。要与GS编码预测进行比较，需要BOM展开。

---

## 3. Target Tables (Analytics) / 目标分析表

**EN:** These tables are created and maintained by the forecast accuracy ETL pipeline. They store computed metrics and serve as the data source for dashboards and alerts.

**CN:** 这些表由预测准确度ETL管道创建和维护。它们存储计算后的指标，并作为仪表盘和告警的数据源。

### 3.1 forecast_accuracy_daily / 每日预测准确度

| Property / 属性 | Value / 值 |
|---|---|
| **Schema.Table** | `test.forecast_accuracy_daily` |
| **Granularity / 粒度** | Per shop x goods x day / 每门店 x 商品 x 日 |
| **Refresh / 刷新** | Daily (T+1) / 每日（T+1） |
| **Retention / 保留** | 365 days / 365天 |

| Column / 字段 | Type / 类型 | Description EN | 描述 CN |
|---|---|---|---|
| `calc_date` | DATE | The date being evaluated (= plan_finish_date) | 被评估的日期（= plan_finish_date） |
| `shop_dept_id` | INT | Store identifier | 门店标识 |
| `shop_name` | VARCHAR | Store display name | 门店显示名称 |
| `goods_code` | VARCHAR | GS code | GS编码 |
| `goods_name` | VARCHAR | Product name | 商品名称 |
| `large_class_name` | VARCHAR | Product large category | 商品大类 |
| `predicted_qty` | DECIMAL | Predicted demand (from vlt_avg_demand) | 预测需求量（来自vlt_avg_demand） |
| `actual_qty` | DECIMAL | Actual consumption (from filtered stock changes) | 实际消耗量（来自筛选后的库存变动） |
| `abs_error` | DECIMAL | Absolute error: \|predicted - actual\| | 绝对误差：\|预测值 - 实际值\| |
| `pct_error` | DECIMAL | Percentage error (APE): \|pred - actual\| / actual | 百分比误差（APE）：\|预测值 - 实际值\| / 实际值 |
| `signed_error` | DECIMAL | Signed error: predicted - actual (+ = over, - = under) | 带符号误差：预测值 - 实际值（+ = 高估，- = 低估） |
| `is_within_20pct` | BOOLEAN | Whether APE < 0.20 (within 20% accuracy band) | APE是否 < 0.20（在20%准确度带内） |
| `prediction_dt` | DATE | When the prediction was generated | 预测生成日期 |
| `task_version_id` | VARCHAR | Algorithm version for traceability | 用于追溯的算法版本 |
| `etl_timestamp` | DATETIME | When this record was computed by the pipeline | 管道计算此记录的时间 |

### 3.2 forecast_accuracy_summary / 预测准确度汇总

| Property / 属性 | Value / 值 |
|---|---|
| **Schema.Table** | `test.forecast_accuracy_summary` |
| **Granularity / 粒度** | Aggregated by period + dimension / 按周期 + 维度聚合 |
| **Refresh / 刷新** | Daily (T+1) / 每日（T+1） |

| Column / 字段 | Type / 类型 | Description EN | 描述 CN |
|---|---|---|---|
| `period_start` | DATE | Start of aggregation period | 聚合周期开始日期 |
| `period_end` | DATE | End of aggregation period | 聚合周期结束日期 |
| `period_type` | VARCHAR | Aggregation period: `daily`, `weekly`, `monthly` | 聚合周期：`daily`、`weekly`、`monthly` |
| `dimension_type` | VARCHAR | Grouping dimension: `overall`, `by_store`, `by_product`, `by_category` | 分组维度：`overall`、`by_store`、`by_product`、`by_category` |
| `dimension_value` | VARCHAR | Dimension value (e.g., store name or goods code) | 维度值（如门店名称或商品编码） |
| `mape` | DECIMAL | Mean Absolute Percentage Error | 平均绝对百分比误差 |
| `wmape` | DECIMAL | Weighted Mean Absolute Percentage Error | 加权平均绝对百分比误差 |
| `rmse` | DECIMAL | Root Mean Square Error | 均方根误差 |
| `mfe_bias` | DECIMAL | Mean Forecast Error (Bias) | 平均预测误差（偏差） |
| `accuracy_rate_20pct` | DECIMAL | % of forecasts within 20% accuracy band | 在20%准确度带内的预测百分比 |
| `tracking_signal` | DECIMAL | Cumulative error / MAD ratio | 累计误差 / MAD 比率 |
| `sample_count` | INT | Number of observations in aggregation | 聚合中的观测数量 |
| `total_predicted_qty` | DECIMAL | Sum of predicted quantities | 预测量合计 |
| `total_actual_qty` | DECIMAL | Sum of actual quantities | 实际量合计 |
| `etl_timestamp` | DATETIME | Pipeline computation timestamp | 管道计算时间戳 |

### 3.3 forecast_alerts / 预测告警

| Property / 属性 | Value / 值 |
|---|---|
| **Schema.Table** | `test.forecast_alerts` |
| **Purpose / 用途** | Drift detection and threshold-based alerting / 漂移检测和基于阈值的告警 |

| Column / 字段 | Type / 类型 | Description EN | 描述 CN |
|---|---|---|---|
| `alert_id` | INT (AUTO) | Unique alert identifier | 唯一告警标识 |
| `alert_date` | DATE | Date the alert was generated | 告警生成日期 |
| `alert_type` | VARCHAR | Alert category: `high_mape`, `bias_drift`, `tracking_signal`, `data_gap` | 告警类别 |
| `severity` | VARCHAR | Alert severity: `critical`, `warning`, `info` | 告警严重度 |
| `shop_dept_id` | INT | Affected store (NULL for global alerts) | 受影响门店（全局告警为NULL） |
| `goods_code` | VARCHAR | Affected product (NULL for store-level alerts) | 受影响商品（门店级告警为NULL） |
| `metric_name` | VARCHAR | Metric that triggered the alert | 触发告警的指标名称 |
| `metric_value` | DECIMAL | Current value of the metric | 指标当前值 |
| `threshold_value` | DECIMAL | Threshold that was breached | 被突破的阈值 |
| `message` | TEXT | Human-readable alert description | 可读的告警描述 |
| `is_resolved` | BOOLEAN | Whether the alert has been resolved | 告警是否已解决 |
| `resolved_at` | DATETIME | When the alert was resolved | 告警解决时间 |
| `etl_timestamp` | DATETIME | Alert creation timestamp | 告警创建时间戳 |

#### Alert Thresholds / 告警阈值

| Alert Type / 告警类型 | Severity / 严重度 | Condition / 条件 | Description EN | 描述 CN |
|---|---|---|---|---|
| `high_mape` | `warning` | MAPE > 40% | Store/product MAPE exceeds warning threshold | 门店/商品MAPE超过预警阈值 |
| `high_mape` | `critical` | MAPE > 60% | Store/product MAPE exceeds critical threshold | 门店/商品MAPE超过严重阈值 |
| `bias_drift` | `warning` | \|MFE\| > 30% of avg actual | Systematic over/under prediction detected | 检测到系统性高估/低估 |
| `tracking_signal` | `warning` | \|TS\| > 4.0 | Tracking signal outside control limits | 追踪信号超出控制限 |
| `tracking_signal` | `critical` | \|TS\| > 6.0 | Severe systematic bias detected | 检测到严重系统性偏差 |
| `data_gap` | `warning` | Missing predictions or actuals for a store-day | Data completeness issue detected | 检测到数据完整性问题 |

### 3.4 pipeline_run_log / 管道运行日志

| Property / 属性 | Value / 值 |
|---|---|
| **Schema.Table** | `test.pipeline_run_log` |
| **Purpose / 用途** | ETL execution tracking and auditability / ETL执行跟踪和可审计性 |

| Column / 字段 | Type / 类型 | Description EN | 描述 CN |
|---|---|---|---|
| `run_id` | INT (AUTO) | Unique run identifier | 唯一运行标识 |
| `run_date` | DATETIME | Pipeline execution start time | 管道执行开始时间 |
| `calc_date` | DATE | Business date being processed | 正在处理的业务日期 |
| `step_name` | VARCHAR | Pipeline step: `extract_predictions`, `extract_actuals`, `compute_metrics`, `generate_alerts`, `build_summary` | 管道步骤名称 |
| `status` | VARCHAR | Execution status: `running`, `success`, `failed`, `skipped` | 执行状态 |
| `rows_processed` | INT | Number of rows processed in this step | 此步骤处理的行数 |
| `error_message` | TEXT | Error details if status = `failed` | 状态为 `failed` 时的错误详情 |
| `duration_seconds` | INT | Step execution duration | 步骤执行时长（秒） |
| `started_at` | DATETIME | Step start timestamp | 步骤开始时间戳 |
| `completed_at` | DATETIME | Step completion timestamp | 步骤完成时间戳 |

---

## 4. Metric Definitions / 指标定义

**EN:** All metrics are computed at the shop x goods x day granularity in the daily table, then aggregated across dimensions in the summary table.

**CN:** 所有指标在每日表中按 门店 x 商品 x 日 粒度计算，然后在汇总表中跨维度聚合。

### 4.1 Core Metrics / 核心指标

| Metric / 指标 | Abbreviation / 缩写 | Formula / 公式 | Interpretation EN | 解读 CN | Industry Benchmark / 行业基准 | Target / 目标 |
|---|---|---|---|---|---|---|
| Mean Absolute Percentage Error | MAPE | `AVG(\|pred - actual\| / actual) x 100` | Average forecast error as percentage of actual; lower is better | 预测误差占实际值百分比的平均值；越低越好 | 20-30% for food/beverage | < 25% |
| Weighted Mean Absolute Percentage Error | WMAPE | `SUM(\|pred - actual\|) / SUM(actual) x 100` | Volume-weighted error; less sensitive to low-volume items; preferred for aggregate reporting | 按量加权的误差；对低销量商品不敏感；适合汇总报告 | 15-25% | < 20% |
| Root Mean Square Error | RMSE | `SQRT(AVG((pred - actual)^2))` | Penalizes large errors more heavily; useful for detecting outlier predictions | 对大误差惩罚更重；用于检测异常预测 | Context-dependent / 视场景而定 | Trending downward |
| Mean Forecast Error (Bias) | MFE | `AVG(pred - actual)` | Positive = systematic over-prediction; Negative = systematic under-prediction | 正值 = 系统性高估；负值 = 系统性低估 | Near 0 / 接近0 | \|MFE\| < 10% of avg |
| Accuracy Rate | AR | `COUNT(APE < 0.20) / COUNT(*) x 100` | Percentage of forecasts falling within the 20% accuracy band | 落在20%准确度带内的预测百分比 | > 60% | > 65% |
| Tracking Signal | TS | `SUM(signed_errors) / MAD` | Detects persistent systematic bias; should remain between -4 and +4 | 检测持续的系统性偏差；应保持在-4到+4之间 | Between -4 and +4 | \|TS\| < 4.0 |

### 4.2 Metric Computation Details / 指标计算详情

#### MAPE (Mean Absolute Percentage Error / 平均绝对百分比误差)

```
MAPE = (1/n) * SUM(|predicted_qty - actual_qty| / actual_qty) * 100

Where:
  n = number of observations where actual_qty > 0
  Note: Observations where actual_qty = 0 are EXCLUDED to avoid division by zero.
        When actual = 0 and predicted > 0, this is logged as a data quality issue.
```

**EN:** MAPE is intuitive but can be distorted by items with very small actual quantities. A prediction of 2 vs actual of 1 yields 100% error, which may disproportionately inflate the average.

**CN:** MAPE直观但可能被实际量很小的商品扭曲。预测2与实际1产生100%的误差，这可能不成比例地膨胀平均值。

#### WMAPE (Weighted Mean Absolute Percentage Error / 加权平均绝对百分比误差)

```
WMAPE = SUM(|predicted_qty - actual_qty|) / SUM(actual_qty) * 100

Where:
  Summation is across all observations in the aggregation window.
  High-volume items naturally receive more weight.
```

**EN:** WMAPE is the preferred headline metric for executive reporting because it is not distorted by low-volume SKUs. It answers: "Of all the units we predicted, what percentage did we get wrong?"

**CN:** WMAPE是高管报告的首选标题指标，因为它不会被低销量SKU扭曲。它回答的问题是："在我们预测的所有单位中，有多少百分比是错误的？"

#### RMSE (Root Mean Square Error / 均方根误差)

```
RMSE = SQRT((1/n) * SUM((predicted_qty - actual_qty)^2))

Where:
  n = number of observations
  Squaring penalizes large deviations more heavily than MAPE.
```

#### MFE / Bias (Mean Forecast Error / 平均预测误差/偏差)

```
MFE = (1/n) * SUM(predicted_qty - actual_qty)

Where:
  Positive MFE = systematic over-prediction (ordering too much -> waste risk)
  Negative MFE = systematic under-prediction (ordering too little -> stockout risk)
```

**EN:** Bias is arguably the most actionable metric. A store consistently over-predicting by 20% means the algorithm's safety stock parameters may need reduction for that location.

**CN:** 偏差可以说是最可操作的指标。一个门店持续高估20%意味着该位置的算法安全库存参数可能需要降低。

#### Accuracy Rate / 准确率

```
Accuracy Rate = COUNT(WHERE |predicted_qty - actual_qty| / actual_qty < 0.20) / COUNT(*) * 100

Where:
  The 20% threshold is configurable.
  Only observations where actual_qty > 0 are included.
```

#### Tracking Signal / 追踪信号

```
Tracking Signal = SUM(predicted_qty - actual_qty) / MAD

Where:
  MAD = Mean Absolute Deviation = (1/n) * SUM(|predicted_qty - actual_qty|)

  Interpretation:
    |TS| < 4.0  -> Forecast is in control (no systematic bias)
    |TS| > 4.0  -> WARNING: Possible systematic bias
    |TS| > 6.0  -> CRITICAL: Definite systematic bias, model needs recalibration

  TS > 0 -> Cumulative over-prediction
  TS < 0 -> Cumulative under-prediction
```

**EN:** The tracking signal is a cumulative measure. It can detect slow-building bias that MAPE alone would miss. For example, if a product is consistently over-predicted by 5% each day, MAPE might look acceptable, but the tracking signal will steadily increase and eventually breach the threshold.

**CN:** 追踪信号是一个累积度量。它可以检测到仅靠MAPE无法发现的缓慢累积偏差。例如，如果一个商品每天持续被高估5%，MAPE可能看起来可接受，但追踪信号会稳步上升，最终突破阈值。

---

## 5. Data Flow Architecture / 数据流架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        DATA FLOW / 数据流                                │
│                                                                         │
│  ┌──────────────────────┐     ┌──────────────────────┐                  │
│  │   PREDICTIONS        │     │   ACTUALS             │                  │
│  │   预测数据             │     │   实际数据             │                  │
│  │                      │     │                       │                  │
│  │  t_order_predict_    │     │  t_shop_goods_stock_  │                  │
│  │  alg_v2              │     │  change_record        │                  │
│  │                      │     │                       │                  │
│  │  Key: shop_dept_id   │     │  Key: shop_dept_id    │                  │
│  │       goods_code     │     │       goods_mid       │                  │
│  │       plan_finish_   │     │       operated_time   │                  │
│  │       date           │     │                       │                  │
│  │                      │     │  Filter:              │                  │
│  │  Value:              │     │    reason_code IN      │                  │
│  │    vlt_avg_demand    │     │    (025,1001,1002)     │                  │
│  │                      │     │    total_adjust_num<0  │                  │
│  │                      │     │                       │                  │
│  └──────────┬───────────┘     └──────────┬────────────┘                  │
│             │                            │                               │
│             │         JOIN ON            │                               │
│             │    shop_dept_id            │                               │
│             │    goods_code=goods_mid    │                               │
│             │    plan_finish_date=       │                               │
│             │      DATE(operated_time)   │                               │
│             │                            │                               │
│             └────────────┬───────────────┘                               │
│                          │                                               │
│                          ▼                                               │
│             ┌────────────────────────┐                                   │
│             │  COMPUTE METRICS       │                                   │
│             │  计算指标                │                                   │
│             │                        │                                   │
│             │  MAPE, WMAPE, RMSE,    │                                   │
│             │  MFE, Accuracy Rate,   │                                   │
│             │  Tracking Signal       │                                   │
│             └────────────┬───────────┘                                   │
│                          │                                               │
│             ┌────────────┼──────────────────────┐                        │
│             │            │                      │                        │
│             ▼            ▼                      ▼                        │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐            │
│  │ forecast_       │ │ forecast_       │ │ forecast_       │            │
│  │ accuracy_daily  │ │ accuracy_       │ │ alerts          │            │
│  │                 │ │ summary         │ │                 │            │
│  │ 每日准确度       │ │ 准确度汇总       │ │ 预测告警         │            │
│  └─────────────────┘ └─────────────────┘ └─────────────────┘            │
│                                                                         │
│                          │                                               │
│                          ▼                                               │
│             ┌────────────────────────┐                                   │
│             │  pipeline_run_log      │                                   │
│             │  管道运行日志            │                                   │
│             └────────────────────────┘                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Pipeline Steps / 管道步骤

| Step # | Step Name | Description EN | 描述 CN | Input | Output |
|---|---|---|---|---|---|
| 1 | `extract_predictions` | Extract prediction records for the target date range | 提取目标日期范围的预测记录 | t_order_predict_alg_v2 | Staging: predictions |
| 2 | `extract_actuals` | Extract and filter consumption records (reason_code filtering) | 提取并筛选消耗记录（原因码筛选） | t_shop_goods_stock_change_record | Staging: actuals |
| 3 | `compute_metrics` | Join predictions with actuals; calculate per-row metrics | 关联预测与实际；计算逐行指标 | Staging tables | forecast_accuracy_daily |
| 4 | `build_summary` | Aggregate daily metrics by period and dimension | 按周期和维度聚合每日指标 | forecast_accuracy_daily | forecast_accuracy_summary |
| 5 | `generate_alerts` | Evaluate metrics against thresholds; create alert records | 评估指标是否超过阈值；创建告警记录 | forecast_accuracy_summary | forecast_alerts |
| 6 | `log_completion` | Record pipeline execution metadata | 记录管道执行元数据 | All steps | pipeline_run_log |

---

## 6. Operational Guide / 运维指南

### 6.1 Pipeline Execution / 管道执行

#### Daily Run Schedule / 每日运行计划

| Time (UTC) / 时间 | Action / 操作 | Description EN | 描述 CN |
|---|---|---|---|
| 06:00 | Pipeline trigger | Automated daily execution for T-1 business date | 自动执行T-1业务日期的每日运行 |
| 06:05 | Extract predictions | Pull predictions where plan_finish_date = T-1 | 提取plan_finish_date = T-1的预测数据 |
| 06:10 | Extract actuals | Pull consumption records for T-1 with reason code filter | 提取T-1的消耗记录（带原因码筛选） |
| 06:20 | Compute metrics | Join and calculate all accuracy metrics | 关联并计算所有准确度指标 |
| 06:25 | Build summary | Aggregate to daily/weekly/monthly summaries | 聚合为日/周/月汇总 |
| 06:30 | Generate alerts | Evaluate thresholds and create alert records | 评估阈值并创建告警记录 |
| 06:35 | Log completion | Write pipeline run log entry | 写入管道运行日志条目 |

#### Manual Execution / 手动执行

```bash
# Run pipeline for a specific date / 为特定日期运行管道
# Replace YYYY-MM-DD with the target business date
python run_pipeline.py --calc-date 2026-02-14

# Backfill a date range / 回填日期范围
python run_pipeline.py --start-date 2026-01-01 --end-date 2026-02-14

# Run only specific steps / 仅运行特定步骤
python run_pipeline.py --calc-date 2026-02-14 --steps extract_predictions,extract_actuals,compute_metrics

# Dry run (no writes) / 试运行（不写入）
python run_pipeline.py --calc-date 2026-02-14 --dry-run
```

#### Idempotency / 幂等性

**EN:** The pipeline is designed to be idempotent. Re-running for the same `calc_date` will DELETE existing records for that date and recompute. This means:
- Safe to re-run after failures
- Backfills will overwrite previous calculations
- Summary table is rebuilt from daily table data

**CN:** 管道设计为幂等的。对同一 `calc_date` 重新运行将删除该日期的现有记录并重新计算。这意味着：
- 失败后可安全重新运行
- 回填将覆盖之前的计算
- 汇总表从每日表数据重建

---

### 6.2 Monitoring & Alerting / 监控与告警

#### Pipeline Health Checks / 管道健康检查

| Check / 检查 | Condition / 条件 | Action / 操作 |
|---|---|---|
| Pipeline completion | No `success` entry in pipeline_run_log for today by 07:00 UTC | Investigate; check DB connectivity and source data availability / 调查；检查数据库连接和源数据可用性 |
| Row count anomaly | Daily rows processed < 50% of 7-day average | Check if predictions were generated; check source table health / 检查预测是否已生成；检查源表状态 |
| Zero actuals | Multiple stores showing 0 actual consumption for a business day | Verify stock change records are flowing; check reason code distribution / 验证库存变动记录是否正常；检查原因码分布 |
| Metric anomaly | Any store MAPE > 100% or WMAPE > 80% | Likely data quality issue; check join match rates / 可能是数据质量问题；检查关联匹配率 |

#### Forecast Alert Escalation / 预测告警升级

| Severity / 严重度 | Response Time / 响应时间 | Action EN | 操作 CN |
|---|---|---|---|
| `info` | Review in next daily standup | Log for trend analysis | 记录用于趋势分析 |
| `warning` | Within 4 hours | Investigate root cause; check if temporary or systemic | 调查根本原因；检查是临时还是系统性问题 |
| `critical` | Within 1 hour | Immediate investigation; notify algorithm team; consider manual order override | 立即调查；通知算法团队；考虑手动订单覆盖 |

---

### 6.3 Troubleshooting / 故障排查

#### Common Issues / 常见问题

**Issue 1: MAPE is extremely high (>200%) for specific products / 特定商品的MAPE极高（>200%）**

| Step / 步骤 | Action EN | 操作 CN |
|---|---|---|
| 1 | Check if `actual_qty` is near zero for those products | 检查这些商品的 `actual_qty` 是否接近零 |
| 2 | Verify reason_code filter is correctly applied (025, 1001, 1002 with total_adjust_num < 0) | 验证原因码筛选是否正确应用（025、1001、1002 且 total_adjust_num < 0） |
| 3 | Check if the product is seasonal or newly launched (limited history) | 检查商品是否为季节性或新上市（历史数据有限） |
| 4 | Review if `vlt_avg_demand` is being used (not `order_num`) | 检查是否使用了 `vlt_avg_demand`（而非 `order_num`） |

**Issue 2: Many NULL or zero actual values / 大量NULL或零实际值**

| Step / 步骤 | Action EN | 操作 CN |
|---|---|---|
| 1 | Check stock change record table for the date -- are records present? | 检查该日期的库存变动记录表——是否有记录？ |
| 2 | Check if day-of-week partitioned tables have data | 检查按星期分区的表是否有数据 |
| 3 | Verify the store was operational on that date (not closed/holiday) | 验证门店在该日期是否营业（非关闭/假日） |
| 4 | Check if consumption reason_code records (025, 1001, 1002) exist for the date | 检查该日期是否存在消耗原因码记录（025、1001、1002） |

**Issue 3: Join match rate is low (<80%) / 关联匹配率低（<80%）**

| Step / 步骤 | Action EN | 操作 CN |
|---|---|---|
| 1 | Check if goods_code and goods_mid use the same GS code format | 检查 goods_code 和 goods_mid 是否使用相同的GS编码格式 |
| 2 | Verify predictions exist for the target date (plan_finish_date) | 验证目标日期（plan_finish_date）是否存在预测 |
| 3 | Check for timezone issues in DATE(operated_time) conversion | 检查 DATE(operated_time) 转换中的时区问题 |
| 4 | Validate shop_dept_id values match between source tables | 验证源表之间的 shop_dept_id 值是否匹配 |

**Issue 4: Pipeline fails at extract step / 管道在提取步骤失败**

| Step / 步骤 | Action EN | 操作 CN |
|---|---|---|
| 1 | Check database server connectivity (aws-luckyus-*-rw endpoints) | 检查数据库服务器连接（aws-luckyus-*-rw 端点） |
| 2 | Verify database credentials are not expired | 验证数据库凭据是否未过期 |
| 3 | Check for table locks or maintenance windows on source databases | 检查源数据库上的表锁或维护窗口 |
| 4 | Review pipeline_run_log.error_message for specific error details | 查看 pipeline_run_log.error_message 获取具体错误详情 |

---

### 6.4 Data Quality Checks / 数据质量检查

#### Pre-computation Checks / 计算前检查

These checks should pass before computing accuracy metrics.

以下检查应在计算准确度指标之前通过。

| Check ID | Check EN | 检查 CN | Severity | SQL Pattern |
|---|---|---|---|---|
| DQ-01 | Predictions exist for calc_date | 计算日期存在预测数据 | CRITICAL | `SELECT COUNT(*) FROM predictions WHERE plan_finish_date = :calc_date` > 0 |
| DQ-02 | Actuals exist for calc_date with consumption reason codes | 计算日期存在消耗原因码的实际数据 | CRITICAL | `SELECT COUNT(*) FROM actuals WHERE DATE(operated_time) = :calc_date AND reason_code IN ('025','1001','1002') AND total_adjust_num < 0` > 0 |
| DQ-03 | At least 5 stores have both predictions and actuals | 至少5个门店同时有预测和实际数据 | WARNING | Join match on shop_dept_id yields >= 5 distinct stores |
| DQ-04 | No duplicate prediction rows (shop x goods x date) | 无重复预测行（门店 x 商品 x 日期） | WARNING | `SELECT ... GROUP BY ... HAVING COUNT(*) > 1` returns 0 rows |
| DQ-05 | vlt_avg_demand values are non-negative | vlt_avg_demand 值非负 | WARNING | `SELECT COUNT(*) WHERE vlt_avg_demand < 0` = 0 |
| DQ-06 | Actual consumption values are non-negative (after ABS) | 实际消耗值非负（取ABS后） | INFO | All ABS(total_adjust_num) >= 0 |

#### Post-computation Checks / 计算后检查

| Check ID | Check EN | 检查 CN | Severity | Threshold |
|---|---|---|---|---|
| DQ-10 | Daily table row count is within expected range | 每日表行数在预期范围内 | WARNING | Between 50% and 200% of 7-day rolling average |
| DQ-11 | No NULL metric values in daily table | 每日表无NULL指标值 | CRITICAL | 0 NULL values for core metrics |
| DQ-12 | MAPE values are within plausible range | MAPE值在合理范围内 | WARNING | 0% < MAPE < 500% (flag outliers above) |
| DQ-13 | Summary table was updated for current period | 汇总表已更新至当前周期 | CRITICAL | etl_timestamp for current period exists |

---

## 7. Business Context / 业务背景

### Why Forecast Accuracy Matters / 为什么预测准确度重要

**EN:**

For Luckin Coffee US operations, forecast accuracy directly impacts three critical business outcomes:

1. **Waste Reduction / 减少浪费:** Over-prediction leads to excess ordering, which for perishable food & beverage ingredients (coffee beans, milk, syrups) directly translates to spoilage waste and increased COGS.

2. **Stockout Prevention / 防止缺货:** Under-prediction leads to stockouts, which means lost revenue, poor customer experience, and potential impact on store-level NPS scores.

3. **Supply Chain Efficiency / 供应链效率:** Accurate forecasts enable optimized delivery scheduling, warehouse space planning, and supplier contract management.

**CN:**

对于 Luckin Coffee 美国业务，预测准确度直接影响三个关键业务成果：

1. **减少浪费：** 高估导致过量订货，对于易腐的食品饮料原料（咖啡豆、牛奶、糖浆），直接转化为变质浪费和COGS增加。

2. **防止缺货：** 低估导致缺货，意味着收入损失、客户体验下降以及可能影响门店级NPS评分。

3. **供应链效率：** 准确的预测能够优化配送计划、仓库空间规划和供应商合同管理。

### Interpretation Guidelines / 解读指南

| Scenario / 场景 | Indicator / 指标 | Action EN | 操作 CN |
|---|---|---|---|
| High MAPE + Positive Bias | Over-prediction | Reduce safety stock multiplier for affected SKUs/stores | 降低受影响SKU/门店的安全库存倍数 |
| High MAPE + Negative Bias | Under-prediction | Increase safety stock; investigate if demand pattern changed | 增加安全库存；调查需求模式是否改变 |
| High MAPE + Near-zero Bias | Volatile/noisy | Model may lack features; consider adding day-of-week, weather, promotions | 模型可能缺少特征；考虑添加星期、天气、促销 |
| Low MAPE + High Tracking Signal | Slow drift | Bias is building over time; schedule model retraining | 偏差随时间累积；安排模型重新训练 |
| Sudden MAPE spike (single day) | Data issue likely | Check for missing actuals, store closures, or one-time events | 检查是否缺少实际数据、门店关闭或一次性事件 |

---

## 8. Appendix / 附录

### A. Code System Reference / 编码系统参考

| Code Type / 编码类型 | Prefix / 前缀 | Scope EN | 范围 CN | Example / 示例 | Used In / 使用场景 |
|---|---|---|---|---|---|
| GS Code | GS | Raw material / ingredient identifier | 原材料/原料标识 | GS00012345 | Predictions (goods_code), Actuals (goods_mid), Product Master (mid) |
| PR Code | PR | Finished product / menu item identifier | 成品/菜单项标识 | PR00067890 | Sales Orders (spu_code), BOM (spu_code) |
| SPU Code | SPU | Standard Product Unit (same scope as PR) | 标准产品单元（与PR同范围） | Similar to PR | Sales Items, BOM |
| shop_dept_id | (numeric) | Store identifier | 门店标识 | 1127, 20008 | All tables |

### B. Database Server Reference / 数据库服务器参考

| Server Alias / 服务器别名 | Database Schema | Tables | Purpose EN | 用途 CN |
|---|---|---|---|---|
| `aws-luckyus-ireplenishment-rw` | luckyus_ireplenishment | t_order_predict_alg_v2 | Demand predictions | 需求预测 |
| `aws-luckyus-scm-shopstock-rw` | luckyus_scm_shopstock | t_shop_goods_stock_change_record (+ DOW variants) | Stock movements | 库存变动 |
| `aws-luckyus-pubdm-rw` | luckyus_pub_dm | t_mdm_goods | Product master data | 商品主数据 |
| `aws-luckyus-opshop-rw` | luckyus_opshop | t_shop_info | Store master data | 门店主数据 |
| `aws-luckyus-scmcommodity-rw` | luckyus_scm_commodity | t_formula_spu | BOM / recipes | BOM/配方 |
| `aws-luckyus-salesorder-rw` | luckyus_sales_order | t_order, t_order_item | Sales transactions | 销售交易 |

### C. Glossary / 术语表

| Term EN | 术语 CN | Definition EN | 定义 CN |
|---|---|---|---|
| APE | 绝对百分比误差 | Absolute Percentage Error: \|pred - actual\| / actual | 绝对百分比误差：\|预测值 - 实际值\| / 实际值 |
| BOM | 物料清单 | Bill of Materials: recipe mapping from finished product to raw materials | 物料清单：从成品到原材料的配方映射 |
| COGS | 销售成本 | Cost of Goods Sold | 销售成本 |
| GS Code | GS编码 | Raw material code used in supply chain systems | 供应链系统中使用的原材料编码 |
| MAD | 平均绝对偏差 | Mean Absolute Deviation: (1/n) * SUM(\|error\|) | 平均绝对偏差 |
| MAPE | 平均绝对百分比误差 | Mean Absolute Percentage Error | 平均绝对百分比误差 |
| MFE | 平均预测误差 | Mean Forecast Error (Bias) | 平均预测误差（偏差） |
| NPS | 净推荐值 | Net Promoter Score | 净推荐值 |
| PR Code | PR编码 | Product (finished product) code used in sales systems | 销售系统中使用的产品（成品）编码 |
| RMSE | 均方根误差 | Root Mean Square Error | 均方根误差 |
| SKU | 库存单位 | Stock Keeping Unit | 库存单位 |
| SPU | 标准产品单元 | Standard Product Unit | 标准产品单元 |
| T+1 | T+1 | Next business day processing (today's data processed tomorrow) | 次日处理（今天的数据明天处理） |
| VLT | 供应商提前期 | Vendor Lead Time | 供应商提前期 |
| WMAPE | 加权平均绝对百分比误差 | Weighted Mean Absolute Percentage Error | 加权平均绝对百分比误差 |

### D. Change Log / 变更日志

| Date / 日期 | Version / 版本 | Author / 作者 | Change EN | 变更 CN |
|---|---|---|---|---|
| 2026-02-15 | 1.0 | Supply Chain Analytics | Initial data dictionary and operational guide | 初始数据字典和运维指南 |

---

> **Document Classification / 文档分类:** Internal Use Only / 仅限内部使用
> **Review Cycle / 审查周期:** Quarterly or upon schema changes / 每季度或表结构变更时
> **Contact / 联系方式:** Supply Chain Analytics Team / 供应链分析团队
