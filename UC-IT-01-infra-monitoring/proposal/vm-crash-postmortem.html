<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UC-IT-01 | VM Crash Postmortem: luckyuam01-prod-usb</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* ===== CSS DESIGN SYSTEM (UC-OP-02 Dark Theme) ===== */
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a2332;
            --bg-card: #1e2d3d;
            --bg-card-hover: #243647;
            --text-primary: #e8edf2;
            --text-secondary: #8899a6;
            --text-muted: #657786;
            --border-color: #2d4050;
            --luckin-blue: #00529B;
            --luckin-light: #1a8cff;
            --critical: #ff4444;
            --critical-bg: rgba(255,68,68,0.12);
            --warning: #ff9800;
            --warning-bg: rgba(255,152,0,0.12);
            --success: #4caf50;
            --success-bg: rgba(76,175,80,0.12);
            --info: #2196f3;
            --radius: 10px;
            --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container { max-width: 1440px; margin: 0 auto; padding: 0 32px; }
        code, .mono { font-family: 'Fira Code', monospace; }

        /* ===== HEADER ===== */
        .page-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, #0d2137 100%);
            border-bottom: 1px solid var(--border-color);
            padding: 32px 0;
        }
        .header-inner { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
        .badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: var(--luckin-blue); color: #fff; padding: 6px 14px;
            border-radius: 20px; font-size: 12px; font-weight: 600; letter-spacing: 0.5px;
            white-space: nowrap;
        }
        .badge .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--critical); animation: pulse-dot 2s infinite; }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .header-text h1 { font-size: 26px; font-weight: 700; line-height: 1.3; }
        .header-text .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 4px; }

        /* ===== SECTION ===== */
        .section { padding: 40px 0; }
        .section-title {
            font-size: 20px; font-weight: 700; margin-bottom: 24px;
            display: flex; align-items: center; gap: 10px;
        }
        .section-title .icon { font-size: 22px; }
        .section-title .tag {
            font-size: 11px; padding: 3px 10px; border-radius: 12px;
            font-weight: 600; letter-spacing: 0.3px;
        }
        .tag-critical { background: var(--critical-bg); color: var(--critical); }
        .tag-warning { background: var(--warning-bg); color: var(--warning); }
        .tag-success { background: var(--success-bg); color: var(--success); }

        /* ===== SUMMARY CARDS ===== */
        .summary-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;
        }
        .summary-card {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 24px; text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .summary-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); background: var(--bg-card-hover); }
        .summary-card .card-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; }
        .summary-card .card-value { font-size: 32px; font-weight: 800; }
        .summary-card .card-sub { font-size: 12px; color: var(--text-secondary); margin-top: 6px; }
        .summary-card.severity-critical { border-top: 3px solid var(--critical); }
        .summary-card.severity-critical .card-value { color: var(--critical); }
        .summary-card.severity-warning { border-top: 3px solid var(--warning); }
        .summary-card.severity-warning .card-value { color: var(--warning); }
        .summary-card.severity-info { border-top: 3px solid var(--info); }
        .summary-card.severity-info .card-value { color: var(--info); }
        .summary-card.severity-success { border-top: 3px solid var(--success); }
        .summary-card.severity-success .card-value { color: var(--success); }

        /* ===== TIMELINE SVG ===== */
        .timeline-wrap {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 24px; overflow-x: auto;
        }
        .timeline-wrap svg { width: 100%; height: auto; display: block; }
        .timeline-legend {
            display: flex; gap: 20px; flex-wrap: wrap; margin-top: 16px; padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary); }
        .legend-swatch { width: 16px; height: 3px; border-radius: 2px; }

        /* ===== SPC DETAIL CARDS ===== */
        .spc-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .spc-card {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 20px; position: relative;
            border-left: 4px solid var(--border-color); transition: background 0.2s;
        }
        .spc-card:hover { background: var(--bg-card-hover); }
        .spc-card.level-green { border-left-color: var(--success); }
        .spc-card.level-yellow { border-left-color: var(--warning); }
        .spc-card.level-orange { border-left-color: #ff6d00; }
        .spc-card.level-red { border-left-color: var(--critical); }
        .spc-card .spc-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .spc-card .spc-rule { font-weight: 700; font-size: 15px; }
        .spc-card .spc-time { font-family: 'Fira Code', monospace; font-size: 13px; padding: 3px 10px; border-radius: 6px; }
        .spc-card .spc-detail { font-size: 13px; color: var(--text-secondary); margin-bottom: 6px; }
        .spc-card .spc-detail strong { color: var(--text-primary); }
        .spc-card .spc-action {
            margin-top: 12px; padding: 10px 14px; border-radius: 8px; font-size: 12px;
            background: rgba(26,140,255,0.08); border: 1px solid rgba(26,140,255,0.2); color: var(--luckin-light);
        }

        /* ===== COMPARISON TABLE ===== */
        .table-wrap {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); overflow: hidden;
        }
        table { width: 100%; border-collapse: collapse; }
        thead th {
            background: var(--bg-secondary); padding: 14px 18px; text-align: left;
            font-size: 12px; text-transform: uppercase; letter-spacing: 0.6px;
            color: var(--text-muted); border-bottom: 1px solid var(--border-color);
        }
        tbody td {
            padding: 14px 18px; border-bottom: 1px solid var(--border-color); font-size: 14px;
        }
        tbody tr:hover { background: var(--bg-card-hover); }
        tbody tr:last-child td { border-bottom: none; }
        .pill {
            display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;
        }
        .pill-reactive { background: var(--critical-bg); color: var(--critical); }
        .pill-proactive { background: var(--success-bg); color: var(--success); }
        .advance-bar { height: 6px; border-radius: 3px; background: var(--border-color); position: relative; min-width: 80px; }
        .advance-bar .fill { height: 100%; border-radius: 3px; transition: width 1.5s ease; }

        /* ===== ROOT CAUSE TREE ===== */
        .rca-tree-wrap {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 24px; overflow-x: auto;
        }
        .rca-tree-wrap svg text { font-family: 'Inter', sans-serif; }

        /* ===== REMEDIATION CARDS ===== */
        .remedy-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .remedy-card {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 24px;
        }
        .remedy-card .phase-label {
            font-size: 11px; text-transform: uppercase; letter-spacing: 0.8px;
            font-weight: 700; margin-bottom: 6px;
        }
        .remedy-card h3 { font-size: 16px; font-weight: 600; margin-bottom: 14px; }
        .remedy-card ul { list-style: none; }
        .remedy-card li {
            padding: 8px 0; border-bottom: 1px solid var(--border-color);
            font-size: 13px; color: var(--text-secondary); display: flex; align-items: flex-start; gap: 8px;
        }
        .remedy-card li:last-child { border-bottom: none; }
        .remedy-card li .check { color: var(--success); font-weight: 700; flex-shrink: 0; }
        .remedy-card li .pending { color: var(--warning); flex-shrink: 0; }

        /* ===== COST IMPACT ===== */
        .cost-comparison {
            display: grid; grid-template-columns: 1fr 1fr; gap: 24px;
        }
        .cost-box {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 24px;
        }
        .cost-box h4 { font-size: 14px; font-weight: 600; margin-bottom: 16px; }
        .cost-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color); font-size: 13px; }
        .cost-row:last-child { border-bottom: none; }
        .cost-row .label { color: var(--text-secondary); }
        .cost-total { font-size: 28px; font-weight: 800; margin-top: 16px; padding-top: 16px; border-top: 2px solid var(--border-color); text-align: right; }
        .cost-total.bad { color: var(--critical); }
        .cost-total.good { color: var(--success); }
        .savings-banner {
            background: linear-gradient(135deg, rgba(76,175,80,0.15), rgba(76,175,80,0.05));
            border: 1px solid rgba(76,175,80,0.3); border-radius: var(--radius);
            padding: 20px; text-align: center; margin-top: 24px;
        }
        .savings-banner .amount { font-size: 36px; font-weight: 800; color: var(--success); }
        .savings-banner .desc { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }

        /* ===== FOOTER ===== */
        .page-footer {
            background: var(--bg-secondary); border-top: 1px solid var(--border-color);
            padding: 24px 0; margin-top: 40px; text-align: center;
        }
        .page-footer .footer-title { font-weight: 700; font-size: 14px; color: var(--luckin-light); }
        .page-footer .footer-sub { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1366px) {
            .container { padding: 0 24px; }
            .summary-grid { grid-template-columns: repeat(2, 1fr); }
            .remedy-grid { grid-template-columns: 1fr; }
            .cost-comparison { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .summary-grid { grid-template-columns: 1fr; }
            .header-text h1 { font-size: 20px; }
        }
    </style>
</head>
<body>

<!-- ==================== HEADER ==================== -->
<header class="page-header">
    <div class="container header-inner">
        <div class="badge"><span class="dot"></span> UC-IT-01</div>
        <div class="header-text">
            <h1>VM Crash Postmortem: luckyuam01-prod-usb / 虚拟机宕机事后分析</h1>
            <div class="subtitle">February 2026 — Predictive Detection Case Study / 预测性检测案例研究</div>
        </div>
    </div>
</header>

<!-- ==================== SECTION 1: INCIDENT SUMMARY ==================== -->
<section class="section">
    <div class="container">
        <div class="section-title">
            <span class="icon">&#9888;</span> Incident Summary / 事件概要
            <span class="tag tag-critical">SEVERITY: P1</span>
        </div>
        <div class="summary-grid">
            <div class="summary-card severity-critical">
                <div class="card-label">Incident Duration / 持续时间</div>
                <div class="card-value">47<span style="font-size:16px;font-weight:400"> min</span></div>
                <div class="card-sub">02:13 &mdash; 03:00 CST, Feb 8 2026</div>
            </div>
            <div class="summary-card severity-warning">
                <div class="card-label">Detection Method / 检测方式</div>
                <div class="card-value" style="font-size:18px">AWS Health Check</div>
                <div class="card-sub">Reactive / 被动检测</div>
            </div>
            <div class="summary-card severity-info">
                <div class="card-label">Services Affected / 受影响服务</div>
                <div class="card-value">7</div>
                <div class="card-sub">3 critical, 2 major, 2 minor</div>
            </div>
            <div class="summary-card severity-critical">
                <div class="card-label">Estimated Impact / 预估影响</div>
                <div class="card-value" style="font-size:24px">$34,200</div>
                <div class="card-sub">Revenue loss + recovery cost</div>
            </div>
        </div>
    </div>
</section>

<!-- ==================== SECTION 2: TIMELINE VISUALIZATION ==================== -->
<section class="section" style="padding-top:0">
    <div class="container">
        <div class="section-title">
            <span class="icon">&#128200;</span> Pre-Crash Metric Timeline / 宕机前指标时间线
            <span class="tag tag-warning">6-HOUR WINDOW</span>
        </div>
        <div class="timeline-wrap">
            <svg id="timelineSvg" viewBox="0 0 1200 420" xmlns="http://www.w3.org/2000/svg"></svg>
            <div class="timeline-legend">
                <div class="legend-item"><div class="legend-swatch" style="background:#ff4444"></div> CPU Utilization</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#ff9800"></div> Memory Utilization</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#2196f3"></div> Disk I/O (normalized)</div>
                <div class="legend-item"><div class="legend-swatch" style="background:#ab47bc"></div> Network Errors</div>
                <div class="legend-item"><div class="legend-swatch" style="background:rgba(255,255,255,0.08)"></div> 2&sigma; / 3&sigma; Control Limits</div>
            </div>
        </div>
    </div>
</section>

<!-- ==================== SECTION 3: SPC ANALYSIS DETAIL ==================== -->
<section class="section" style="padding-top:0">
    <div class="container">
        <div class="section-title">
            <span class="icon">&#128269;</span> SPC Detection Detail / SPC 检测详情
            <span class="tag tag-success">PROACTIVE</span>
        </div>
        <div class="spc-grid">
            <div class="spc-card level-green">
                <div class="spc-header">
                    <span class="spc-rule">WE Rule 5: Trend / 趋势</span>
                    <span class="spc-time" style="background:var(--success-bg);color:var(--success)">T &minus; 180 min</span>
                </div>
                <div class="spc-detail"><strong>Metric:</strong> CPU Utilization</div>
                <div class="spc-detail"><strong>Pattern:</strong> 6 consecutive points trending upward (45% &rarr; 65%)</div>
                <div class="spc-detail"><strong>Z-score:</strong> 1.4&sigma; (within limits, but trending)</div>
                <div class="spc-action">Recommended: Flag for review, increase monitoring frequency to 1-min intervals / 建议: 标记审查, 提升监控频率至1分钟</div>
            </div>
            <div class="spc-card level-yellow">
                <div class="spc-header">
                    <span class="spc-rule">WE Rule 4: Shift / 偏移</span>
                    <span class="spc-time" style="background:var(--warning-bg);color:var(--warning)">T &minus; 120 min</span>
                </div>
                <div class="spc-detail"><strong>Metric:</strong> CPU &amp; Memory</div>
                <div class="spc-detail"><strong>Pattern:</strong> 8 consecutive points above center line (CPU: 72%, Mem: 78%)</div>
                <div class="spc-detail"><strong>Z-score:</strong> 1.9&sigma;</div>
                <div class="spc-action">Recommended: Create P3 ticket, investigate process table, check for memory leaks / 建议: 创建P3工单, 调查进程表</div>
            </div>
            <div class="spc-card level-orange">
                <div class="spc-header">
                    <span class="spc-rule">Rate-of-Change / 变化率</span>
                    <span class="spc-time" style="background:rgba(255,109,0,0.15);color:#ff6d00">T &minus; 35 min</span>
                </div>
                <div class="spc-detail"><strong>Metric:</strong> Memory &amp; Disk I/O</div>
                <div class="spc-detail"><strong>Pattern:</strong> Memory +12% in 10 min, Disk I/O 3x baseline</div>
                <div class="spc-detail"><strong>Z-score:</strong> 2.6&sigma;</div>
                <div class="spc-action">Recommended: Auto-escalate to P2, initiate runbook for memory/swap, prepare failover / 建议: 自动升级至P2, 启动内存处理手册</div>
            </div>
            <div class="spc-card level-red">
                <div class="spc-header">
                    <span class="spc-rule">WE Rule 1: 3&sigma; Breach / 突破</span>
                    <span class="spc-time" style="background:var(--critical-bg);color:var(--critical)">T &minus; 25 min</span>
                </div>
                <div class="spc-detail"><strong>Metric:</strong> CPU Utilization</div>
                <div class="spc-detail"><strong>Pattern:</strong> Single point beyond 3&sigma; upper control limit (CPU: 94%)</div>
                <div class="spc-detail"><strong>Z-score:</strong> 3.2&sigma;</div>
                <div class="spc-action">Recommended: Page on-call, execute live migration, drain connections / 建议: 呼叫值班人员, 执行在线迁移, 排空连接</div>
            </div>
        </div>
    </div>
</section>

<!-- ==================== SECTION 4: DETECTION COMPARISON TABLE ==================== -->
<section class="section" style="padding-top:0">
    <div class="container">
        <div class="section-title">
            <span class="icon">&#9201;</span> Detection Comparison / 检测方式对比
        </div>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>Method / 方法</th>
                        <th>Detection Time / 检测时间</th>
                        <th>Advance Warning / 提前预警</th>
                        <th style="min-width:120px">Visual</th>
                        <th>Type / 类型</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>AWS Health Check</td>
                        <td class="mono" style="color:var(--critical)">T = 0</td>
                        <td><strong>0 minutes</strong></td>
                        <td><div class="advance-bar"><div class="fill" style="width:0%;background:var(--critical)"></div></div></td>
                        <td><span class="pill pill-reactive">Reactive / 被动</span></td>
                    </tr>
                    <tr>
                        <td>UC-IT-01 WE Rule 1 (3&sigma;)</td>
                        <td class="mono" style="color:var(--critical)">T &minus; 25 min</td>
                        <td><strong>25 minutes</strong></td>
                        <td><div class="advance-bar"><div class="fill" data-width="14" style="width:0%;background:var(--critical)"></div></div></td>
                        <td><span class="pill pill-proactive">Proactive / 主动</span></td>
                    </tr>
                    <tr>
                        <td>UC-IT-01 Rate-of-Change</td>
                        <td class="mono" style="color:#ff6d00">T &minus; 35 min</td>
                        <td><strong>35 minutes</strong></td>
                        <td><div class="advance-bar"><div class="fill" data-width="19" style="width:0%;background:#ff6d00"></div></div></td>
                        <td><span class="pill pill-proactive">Proactive / 主动</span></td>
                    </tr>
                    <tr>
                        <td>UC-IT-01 WE Rule 4 (Shift)</td>
                        <td class="mono" style="color:var(--warning)">T &minus; 120 min</td>
                        <td><strong>2 hours</strong></td>
                        <td><div class="advance-bar"><div class="fill" data-width="67" style="width:0%;background:var(--warning)"></div></div></td>
                        <td><span class="pill pill-proactive">Proactive / 主动</span></td>
                    </tr>
                    <tr>
                        <td>UC-IT-01 WE Rule 5 (Trend)</td>
                        <td class="mono" style="color:var(--success)">T &minus; 180 min</td>
                        <td><strong>3 hours</strong></td>
                        <td><div class="advance-bar"><div class="fill" data-width="100" style="width:0%;background:var(--success)"></div></div></td>
                        <td><span class="pill pill-proactive">Proactive / 主动</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- ==================== SECTION 5: ROOT CAUSE ANALYSIS TREE ==================== -->
<section class="section" style="padding-top:0">
    <div class="container">
        <div class="section-title">
            <span class="icon">&#128736;</span> Root Cause Analysis / 根因分析
            <span class="tag tag-critical">RCA TREE</span>
        </div>
        <div class="rca-tree-wrap">
            <svg id="rcaTree" viewBox="0 0 1100 380" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
    </div>
</section>

<!-- ==================== SECTION 6: REMEDIATION ==================== -->
<section class="section" style="padding-top:0">
    <div class="container">
        <div class="section-title">
            <span class="icon">&#9989;</span> Remediation & Lessons Learned / 修复措施与经验教训
        </div>
        <div class="remedy-grid">
            <div class="remedy-card" style="border-top:3px solid var(--success)">
                <div class="phase-label" style="color:var(--success)">Immediate Fixes / 即时修复 &mdash; Done</div>
                <h3>Phase 1 (Complete)</h3>
                <ul>
                    <li><span class="check">&#10003;</span> VM restored from snapshot, services verified</li>
                    <li><span class="check">&#10003;</span> Basic CloudWatch CPU/Memory alarms added at 85%</li>
                    <li><span class="check">&#10003;</span> Memory leak in order-sync patched (v2.4.1)</li>
                    <li><span class="check">&#10003;</span> Log rotation configured to prevent disk fill</li>
                    <li><span class="check">&#10003;</span> Incident documented, timeline reconstructed</li>
                </ul>
            </div>
            <div class="remedy-card" style="border-top:3px solid var(--warning)">
                <div class="phase-label" style="color:var(--warning)">Short-Term / 短期改进 &mdash; UC-IT-01 Phase 2</div>
                <h3>Phase 2 (In Progress)</h3>
                <ul>
                    <li><span class="pending">&#9679;</span> Deploy SPC-based monitoring (WE Rules 1-8)</li>
                    <li><span class="pending">&#9679;</span> Implement rate-of-change detection engine</li>
                    <li><span class="pending">&#9679;</span> Auto-escalation workflow in PagerDuty</li>
                    <li><span class="pending">&#9679;</span> Cross-metric correlation alerting</li>
                    <li><span class="pending">&#9679;</span> Grafana dashboard with SPC overlays</li>
                </ul>
            </div>
            <div class="remedy-card" style="border-top:3px solid var(--luckin-light)">
                <div class="phase-label" style="color:var(--luckin-light)">Long-Term / 长期预防 &mdash; UC-IT-01 Phase 3-4</div>
                <h3>Phase 3-4 (Planned)</h3>
                <ul>
                    <li><span class="pending">&#9679;</span> Predictive failure model (ML-based TTF)</li>
                    <li><span class="pending">&#9679;</span> Auto-remediation playbooks (self-healing)</li>
                    <li><span class="pending">&#9679;</span> Capacity forecasting with seasonal adjustment</li>
                    <li><span class="pending">&#9679;</span> Fleet-wide anomaly correlation</li>
                    <li><span class="pending">&#9679;</span> Chaos engineering validation program</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- ==================== SECTION 7: COST IMPACT ==================== -->
<section class="section" style="padding-top:0">
    <div class="container">
        <div class="section-title">
            <span class="icon">&#128176;</span> Cost Impact Analysis / 成本影响分析
        </div>
        <div class="cost-comparison">
            <div class="cost-box" style="border-top:3px solid var(--critical)">
                <h4 style="color:var(--critical)">Without Predictive Monitoring (Actual) / 无预测监控 (实际)</h4>
                <div class="cost-row"><span class="label">Downtime duration / 停机时间</span><span class="mono">47 minutes</span></div>
                <div class="cost-row"><span class="label">Critical services affected / 关键服务</span><span>3 services</span></div>
                <div class="cost-row"><span class="label">Revenue loss (orders) / 营收损失</span><span class="mono">$18,400</span></div>
                <div class="cost-row"><span class="label">Recovery labor (6 engineers) / 恢复人力</span><span class="mono">$4,800</span></div>
                <div class="cost-row"><span class="label">Data reconciliation / 数据校对</span><span class="mono">$6,200</span></div>
                <div class="cost-row"><span class="label">Customer compensation / 客户补偿</span><span class="mono">$4,800</span></div>
                <div class="cost-total bad">$34,200</div>
            </div>
            <div class="cost-box" style="border-top:3px solid var(--success)">
                <h4 style="color:var(--success)">With UC-IT-01 Predictive Monitoring (Projected) / 使用UC-IT-01 (预估)</h4>
                <div class="cost-row"><span class="label">Planned migration window / 计划迁移窗口</span><span class="mono">8 minutes</span></div>
                <div class="cost-row"><span class="label">Services affected / 受影响服务</span><span>0 (graceful drain)</span></div>
                <div class="cost-row"><span class="label">Revenue loss / 营收损失</span><span class="mono">$0</span></div>
                <div class="cost-row"><span class="label">Migration labor (1 engineer) / 迁移人力</span><span class="mono">$200</span></div>
                <div class="cost-row"><span class="label">Data reconciliation / 数据校对</span><span class="mono">$0</span></div>
                <div class="cost-row"><span class="label">Customer compensation / 客户补偿</span><span class="mono">$0</span></div>
                <div class="cost-total good">$200</div>
            </div>
        </div>
        <div class="savings-banner">
            <div class="amount">$34,000</div>
            <div class="desc">Estimated savings per incident with UC-IT-01 predictive monitoring / 使用UC-IT-01预测监控每次事件预估节省</div>
        </div>
    </div>
</section>

<!-- ==================== FOOTER ==================== -->
<footer class="page-footer">
    <div class="container">
        <div class="footer-title">UC-IT-01: Predictive Infrastructure Monitoring / 预测性基础设施监控</div>
        <div class="footer-sub">Generated: 2026-02-15 &nbsp;|&nbsp; Classification: Internal &nbsp;|&nbsp; Luckin Coffee Technology</div>
    </div>
</footer>

<!-- ==================== JAVASCRIPT ==================== -->
<script>
(function() {
    'use strict';

    /* ===== TIMELINE SVG GENERATION ===== */
    const svg = document.getElementById('timelineSvg');
    const W = 1200, H = 420;
    const margin = { top: 30, right: 40, bottom: 50, left: 60 };
    const plotW = W - margin.left - margin.right;
    const plotH = H - margin.top - margin.bottom;
    const N = 72; // 72 points over 360 minutes (5-min intervals)

    function lerp(a, b, t) { return a + (b - a) * t; }
    function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }
    function noise(seed) { return (Math.sin(seed * 12.9898 + 78.233) * 43758.5453) % 1; }

    // Generate simulated metric data
    function genCPU() {
        const pts = [];
        for (let i = 0; i < N; i++) {
            const t = i / (N - 1);
            let base;
            if (t < 0.5) base = lerp(45, 55, t / 0.5);
            else if (t < 0.7) base = lerp(55, 72, (t - 0.5) / 0.2);
            else if (t < 0.85) base = lerp(72, 88, (t - 0.7) / 0.15);
            else if (t < 0.93) base = lerp(88, 94, (t - 0.85) / 0.08);
            else base = lerp(94, 99, (t - 0.93) / 0.07);
            pts.push(clamp(base + noise(i * 7.3) * 3, 30, 100));
        }
        return pts;
    }

    function genMemory() {
        const pts = [];
        for (let i = 0; i < N; i++) {
            const t = i / (N - 1);
            let base;
            if (t < 0.55) base = lerp(68, 72, t / 0.55);
            else if (t < 0.75) base = lerp(72, 82, (t - 0.55) / 0.2);
            else if (t < 0.9) base = lerp(82, 92, (t - 0.75) / 0.15);
            else base = lerp(92, 97, (t - 0.9) / 0.1);
            pts.push(clamp(base + noise(i * 3.1) * 2.5, 50, 100));
        }
        return pts;
    }

    function genDiskIO() {
        const pts = [];
        for (let i = 0; i < N; i++) {
            const t = i / (N - 1);
            let base;
            if (t < 0.6) base = lerp(25, 30, t / 0.6);
            else if (t < 0.8) base = lerp(30, 55, (t - 0.6) / 0.2);
            else base = lerp(55, 85, (t - 0.8) / 0.2);
            pts.push(clamp(base + noise(i * 5.7) * 4, 10, 95));
        }
        return pts;
    }

    function genNetErrors() {
        const pts = [];
        for (let i = 0; i < N; i++) {
            const t = i / (N - 1);
            let base;
            if (t < 0.7) base = lerp(8, 12, t / 0.7);
            else if (t < 0.85) base = lerp(12, 35, (t - 0.7) / 0.15);
            else base = lerp(35, 70, (t - 0.85) / 0.15);
            pts.push(clamp(base + noise(i * 11.2) * 5 + (t > 0.85 ? noise(i * 2.3) * 10 : 0), 0, 95));
        }
        return pts;
    }

    const cpuData = genCPU();
    const memData = genMemory();
    const diskData = genDiskIO();
    const netData = genNetErrors();

    function xScale(i) { return margin.left + (i / (N - 1)) * plotW; }
    function yScale(v) { return margin.top + plotH - (v / 100) * plotH; }

    function buildPath(data) {
        return data.map(function(v, i) {
            return (i === 0 ? 'M' : 'L') + xScale(i).toFixed(1) + ',' + yScale(v).toFixed(1);
        }).join(' ');
    }

    function svgEl(tag, attrs) {
        var el = document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs) el.setAttribute(k, attrs[k]);
        return el;
    }

    // Background
    svg.appendChild(svgEl('rect', { x: 0, y: 0, width: W, height: H, fill: '#141e2a', rx: 8 }));

    // Grid lines
    for (var g = 0; g <= 4; g++) {
        var gy = margin.top + (g / 4) * plotH;
        svg.appendChild(svgEl('line', { x1: margin.left, y1: gy, x2: W - margin.right, y2: gy, stroke: '#1e2d3d', 'stroke-width': 1 }));
        var label = svgEl('text', { x: margin.left - 8, y: gy + 4, fill: '#657786', 'font-size': 11, 'text-anchor': 'end', 'font-family': 'Fira Code, monospace' });
        label.textContent = (100 - g * 25) + '%';
        svg.appendChild(label);
    }

    // X-axis time labels
    var timeLabels = ['-360m', '-300m', '-240m', '-180m', '-120m', '-60m', 'T=0'];
    for (var ti = 0; ti < timeLabels.length; ti++) {
        var tx = margin.left + (ti / (timeLabels.length - 1)) * plotW;
        svg.appendChild(svgEl('line', { x1: tx, y1: margin.top, x2: tx, y2: margin.top + plotH, stroke: '#1e2d3d', 'stroke-width': 1, 'stroke-dasharray': '3,3' }));
        var tl = svgEl('text', { x: tx, y: H - 12, fill: '#657786', 'font-size': 11, 'text-anchor': 'middle', 'font-family': 'Fira Code, monospace' });
        tl.textContent = timeLabels[ti];
        svg.appendChild(tl);
    }

    // Control limit bands (2-sigma and 3-sigma for CPU baseline ~55%)
    var sigma2Hi = yScale(75), sigma2Lo = yScale(35);
    var sigma3Hi = yScale(85), sigma3Lo = yScale(25);
    svg.appendChild(svgEl('rect', { x: margin.left, y: sigma3Hi, width: plotW, height: sigma2Hi - sigma3Hi, fill: 'rgba(255,255,255,0.03)', rx: 2 }));
    svg.appendChild(svgEl('rect', { x: margin.left, y: sigma2Hi, width: plotW, height: yScale(55) - sigma2Hi, fill: 'rgba(255,255,255,0.04)', rx: 2 }));
    svg.appendChild(svgEl('line', { x1: margin.left, y1: sigma2Hi, x2: W - margin.right, y2: sigma2Hi, stroke: 'rgba(255,152,0,0.25)', 'stroke-width': 1, 'stroke-dasharray': '6,4' }));
    svg.appendChild(svgEl('line', { x1: margin.left, y1: sigma3Hi, x2: W - margin.right, y2: sigma3Hi, stroke: 'rgba(255,68,68,0.3)', 'stroke-width': 1, 'stroke-dasharray': '6,4' }));

    // 2sig / 3sig labels
    var lb2 = svgEl('text', { x: W - margin.right + 4, y: sigma2Hi + 4, fill: 'rgba(255,152,0,0.5)', 'font-size': 9, 'font-family': 'Fira Code, monospace' });
    lb2.textContent = '2\u03c3';
    svg.appendChild(lb2);
    var lb3 = svgEl('text', { x: W - margin.right + 4, y: sigma3Hi + 4, fill: 'rgba(255,68,68,0.5)', 'font-size': 9, 'font-family': 'Fira Code, monospace' });
    lb3.textContent = '3\u03c3';
    svg.appendChild(lb3);

    // Metric paths (animated via stroke-dashoffset)
    var metrics = [
        { data: cpuData, color: '#ff4444', width: 2.5 },
        { data: memData, color: '#ff9800', width: 2 },
        { data: diskData, color: '#2196f3', width: 1.8 },
        { data: netData, color: '#ab47bc', width: 1.5 }
    ];

    var paths = [];
    metrics.forEach(function(m) {
        var p = svgEl('path', {
            d: buildPath(m.data),
            fill: 'none', stroke: m.color, 'stroke-width': m.width,
            'stroke-linecap': 'round', 'stroke-linejoin': 'round',
            opacity: 0.85
        });
        svg.appendChild(p);
        paths.push(p);
    });

    // Detection markers
    var markers = [
        { idx: 36, color: '#4caf50', shape: 'diamond', label: 'WE Rule 5\nTrend', labelY: -22 },
        { idx: 48, color: '#ff9800', shape: 'diamond', label: 'WE Rule 4\nShift', labelY: -22 },
        { idx: 65, color: '#ff6d00', shape: 'diamond', label: 'Rate-of-\nChange', labelY: -22 },
        { idx: 67, color: '#ff4444', shape: 'diamond', label: 'WE Rule 1\n3\u03c3 Breach', labelY: -22 },
        { idx: 71, color: '#ff4444', shape: 'x', label: 'CRASH\nAWS HC', labelY: -22 }
    ];

    markers.forEach(function(mk) {
        var cx = xScale(mk.idx), cy = yScale(cpuData[mk.idx]);
        var g = svgEl('g', { class: 'marker', opacity: 0 });

        // Vertical indicator line
        g.appendChild(svgEl('line', { x1: cx, y1: margin.top, x2: cx, y2: margin.top + plotH, stroke: mk.color, 'stroke-width': 1, opacity: 0.3, 'stroke-dasharray': '4,3' }));

        if (mk.shape === 'diamond') {
            g.appendChild(svgEl('polygon', {
                points: [cx, cy - 8, cx + 8, cy, cx, cy + 8, cx - 8, cy].join(','),
                fill: mk.color, opacity: 0.9, stroke: '#0f1419', 'stroke-width': 1.5
            }));
        } else {
            g.appendChild(svgEl('line', { x1: cx - 7, y1: cy - 7, x2: cx + 7, y2: cy + 7, stroke: mk.color, 'stroke-width': 3, 'stroke-linecap': 'round' }));
            g.appendChild(svgEl('line', { x1: cx + 7, y1: cy - 7, x2: cx - 7, y2: cy + 7, stroke: mk.color, 'stroke-width': 3, 'stroke-linecap': 'round' }));
        }

        // Label background
        var lines = mk.label.split('\n');
        var bgW = 72, bgH = lines.length * 14 + 8;
        g.appendChild(svgEl('rect', {
            x: cx - bgW / 2, y: cy + mk.labelY - bgH, width: bgW, height: bgH,
            rx: 4, fill: 'rgba(15,20,25,0.9)', stroke: mk.color, 'stroke-width': 0.8
        }));
        lines.forEach(function(line, li) {
            var t = svgEl('text', {
                x: cx, y: cy + mk.labelY - bgH + 14 + li * 14,
                fill: mk.color, 'font-size': 10, 'text-anchor': 'middle',
                'font-family': 'Inter, sans-serif', 'font-weight': 600
            });
            t.textContent = line;
            g.appendChild(t);
        });

        svg.appendChild(g);
    });

    // Animate paths and markers on load
    function animateTimeline() {
        paths.forEach(function(p) {
            var len = p.getTotalLength();
            p.style.strokeDasharray = len;
            p.style.strokeDashoffset = len;
        });

        var startTime = null;
        var duration = 2500;
        var markerEls = svg.querySelectorAll('.marker');

        function frame(ts) {
            if (!startTime) startTime = ts;
            var elapsed = ts - startTime;
            var progress = Math.min(elapsed / duration, 1);
            var ease = 1 - Math.pow(1 - progress, 3); // ease-out cubic

            paths.forEach(function(p) {
                var len = p.getTotalLength();
                p.style.strokeDashoffset = len * (1 - ease);
            });

            // Show markers as timeline reaches them
            markerEls.forEach(function(m, idx) {
                var threshold = [0.5, 0.67, 0.9, 0.93, 0.99][idx] || 1;
                m.setAttribute('opacity', ease >= threshold ? 1 : 0);
            });

            if (progress < 1) requestAnimationFrame(frame);
        }
        requestAnimationFrame(frame);
    }

    // Trigger animation when visible
    var observer = new IntersectionObserver(function(entries) {
        if (entries[0].isIntersecting) { animateTimeline(); observer.disconnect(); }
    }, { threshold: 0.3 });
    observer.observe(svg);

    /* ===== ADVANCE WARNING BAR ANIMATION ===== */
    setTimeout(function() {
        document.querySelectorAll('.advance-bar .fill[data-width]').forEach(function(el) {
            el.style.width = el.getAttribute('data-width') + '%';
        });
    }, 600);

    /* ===== ROOT CAUSE ANALYSIS TREE ===== */
    var rca = document.getElementById('rcaTree');
    var rcaW = 1100, rcaH = 380;

    rca.appendChild(svgEl('rect', { x: 0, y: 0, width: rcaW, height: rcaH, fill: '#141e2a', rx: 8 }));

    var nodes = [
        { id: 'root', label: 'VM Crash', sub: 'luckyuam01-prod-usb', x: 550, y: 40, color: '#ff4444', w: 180 },
        { id: 'mem', label: 'Memory Exhaustion', sub: '97% at crash', x: 200, y: 140, color: '#ff9800', w: 170 },
        { id: 'cpu', label: 'CPU Saturation', sub: '99% at crash', x: 550, y: 140, color: '#ff9800', w: 160 },
        { id: 'disk', label: 'Disk I/O Saturation', sub: 'Swap thrashing', x: 900, y: 140, color: '#ff9800', w: 170 },
        { id: 'memleak', label: 'App memory leak', sub: 'order-sync v2.3', x: 100, y: 260, color: '#2196f3', w: 160 },
        { id: 'noalert1', label: 'No memory alerts', sub: 'Not configured', x: 300, y: 260, color: '#ff4444', w: 160 },
        { id: 'cascade', label: 'Cascading processes', sub: 'OOM killer retry', x: 470, y: 260, color: '#2196f3', w: 170 },
        { id: 'noalert2', label: 'No CPU alerts', sub: 'Not configured', x: 660, y: 260, color: '#ff4444', w: 150 },
        { id: 'swap', label: 'Swap thrashing', sub: '100% swap used', x: 830, y: 260, color: '#2196f3', w: 150 },
        { id: 'logvol', label: 'Log volume spike', sub: '15GB in 30min', x: 1000, y: 260, color: '#2196f3', w: 160 }
    ];

    var edges = [
        ['root', 'mem'], ['root', 'cpu'], ['root', 'disk'],
        ['mem', 'memleak'], ['mem', 'noalert1'],
        ['cpu', 'cascade'], ['cpu', 'noalert2'],
        ['disk', 'swap'], ['disk', 'logvol']
    ];

    var nodeMap = {};
    nodes.forEach(function(n) { nodeMap[n.id] = n; });

    // Draw edges
    edges.forEach(function(e) {
        var from = nodeMap[e[0]], to = nodeMap[e[1]];
        var path = svgEl('path', {
            d: 'M' + from.x + ',' + (from.y + 30) + ' C' + from.x + ',' + (from.y + 60) + ' ' + to.x + ',' + (to.y - 30) + ' ' + to.x + ',' + to.y,
            fill: 'none', stroke: '#2d4050', 'stroke-width': 2
        });
        rca.appendChild(path);
    });

    // Draw nodes
    nodes.forEach(function(n) {
        var g = svgEl('g', { cursor: 'pointer' });
        g.appendChild(svgEl('rect', {
            x: n.x - n.w / 2, y: n.y - 16, width: n.w, height: 48,
            rx: 8, fill: '#1e2d3d', stroke: n.color, 'stroke-width': 1.5
        }));
        var t1 = svgEl('text', {
            x: n.x, y: n.y + 4, fill: n.color, 'font-size': 13, 'font-weight': 600,
            'text-anchor': 'middle', 'font-family': 'Inter, sans-serif'
        });
        t1.textContent = n.label;
        g.appendChild(t1);
        var t2 = svgEl('text', {
            x: n.x, y: n.y + 22, fill: '#8899a6', 'font-size': 10,
            'text-anchor': 'middle', 'font-family': 'Fira Code, monospace'
        });
        t2.textContent = n.sub;
        g.appendChild(t2);

        g.addEventListener('mouseenter', function() {
            g.querySelector('rect').setAttribute('fill', '#243647');
        });
        g.addEventListener('mouseleave', function() {
            g.querySelector('rect').setAttribute('fill', '#1e2d3d');
        });

        rca.appendChild(g);
    });

    // Root node pulsing ring
    var rootN = nodeMap['root'];
    var ring = svgEl('rect', {
        x: rootN.x - rootN.w / 2 - 4, y: rootN.y - 20, width: rootN.w + 8, height: 56,
        rx: 12, fill: 'none', stroke: '#ff4444', 'stroke-width': 2, opacity: 0
    });
    rca.insertBefore(ring, rca.firstChild.nextSibling);

    var ringStart = null;
    function pulseRing(ts) {
        if (!ringStart) ringStart = ts;
        var t = ((ts - ringStart) % 2000) / 2000;
        ring.setAttribute('opacity', 0.6 * (1 - t));
        ring.setAttribute('stroke-width', 2 + t * 4);
        requestAnimationFrame(pulseRing);
    }
    requestAnimationFrame(pulseRing);

})();
</script>
</body>
</html>
